<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>
ä¸­æ£® MPU è¡Œé–“åŸ‹ã‚ Appendix IV å¾ŒåŠ ä¹—ç®—å™¨ | å†·ãŸãæ²¢ã®å²©é™°ã®
</title>

        
<meta property="og:image" content="https:&#x2F;&#x2F;kenoss.github.io&#x2F;ogp.jpg" />
<meta property="og:title" content="ä¸­æ£® MPU è¡Œé–“åŸ‹ã‚ Appendix IV å¾ŒåŠ ä¹—ç®—å™¨" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https:&#x2F;&#x2F;kenoss.github.io&#x2F;blog&#x2F;2025-08-05-nakamori-mpu-appendix-4-multiplier&#x2F;" />

<meta property="og:site_name" content="å†·ãŸãæ²¢ã®å²©é™°ã®" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@keno_ss" />


        

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"
      integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP"
      crossorigin="anonymous">
<script defer
        src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"
        integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6"
        crossorigin="anonymous"></script>
<script defer
        src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"
        integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh"
        crossorigin="anonymous"></script>
<script>
   document.addEventListener("DOMContentLoaded", function() {
     renderMathInElement(document.body, {
       delimiters: [
         {left: '$$', right: '$$', display: true},
         {left: '$', right: '$', display: false},
         {left: '\\[', right: '\\]', display: true},
         {left: '\\(', right: '\\)', display: false}
       ],
       throwOnError : false
     });
   });
</script>



        <link rel="stylesheet" href="https://kenoss.github.io/theme.css">
    </head>
    <body>
        <div class="content">
            <header>
                <div class="header-left">
                    <a href="https:&#x2F;&#x2F;kenoss.github.io" class="header-logo">å†·ãŸãæ²¢ã®å²©é™°ã®</a>
                </div>
                <div class="header-right">
                </div>
            </header>
            <main>
                
<article itemscope itemtype="http://schema.org/BlogPosting">
    <div class="headline" itemprop="headline">
        <h1 class="post-title">ä¸­æ£® MPU è¡Œé–“åŸ‹ã‚ Appendix IV å¾ŒåŠ ä¹—ç®—å™¨</h2>
        <div class="border"></div>
        <div>
            <time datetime="2025-08-05" class="post-date" itemprop="datePublished">
                2025-08-05
            </time>
            
                |
                
                    <span class="post-tag">ğŸ¦€ tech</span>
                
                    <span class="post-tag">ğŸ¦€ ä¸­æ£® MPU</span>
                
                        
        </div>
    </div>
    <div itemprop="articleBody">
        <p>$$
\gdef\defeq{\mathrel{\mathop:}=}
$$</p>
<p><a href="../2025-08-04-nakamori-mpu-appendix-4-adder">å‰å›</a> ã®ç¶šãã§ä¹—ç®—å™¨.</p>
<p>ã‚³ãƒ¼ãƒ‰ã¯ Python.</p>
<h2 id="disclaimer">Disclaimer</h2>
<p>è«–ç†åˆæˆã¨ã‹ä¿¡å·å‡¦ç†ã¨ã‹å…¨ç„¶ã‚ã‹ã‚‰ãªã„. è‡ªåˆ†ãŒç´å¾—ã§ãã‚‹ã¾ã§èª¿ã¹ãŸçµæœã‚’ã¾ã¨ã‚ã¦ã„ã‚‹ã ã‘ã§ã‚ã‚‹.</p>
<p>ã‚ã¨ä»Šå›ã®å†…å®¹ã¯
<a href="https://ja.wikipedia.org/wiki/%E3%83%96%E3%83%BC%E3%82%B9%E3%81%AE%E4%B9%97%E7%AE%97%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0">Wikipedia -- ãƒ–ãƒ¼ã‚¹ã®ä¹—ç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </a>
ã‚’èª­ã‚ã°å¤§ä½“ã‚ã‹ã‚‹ã‚‚ã®ã§ã‚ã‚‹.</p>
<h2 id="wen-ti-she-ding">å•é¡Œè¨­å®š</h2>
<p>Q. n bit ã®æ•´æ•°ãµãŸã¤ $x, y$ ã‚’ä¹—ç®—ã—ãŸã„.</p>
<p>signed ã¨ä»®å®šã—ã¦ã‚ˆã„. (æœ¬æ›¸å‚ç…§.)</p>
<p>(éæ¨™æº–çš„è¨˜æ³•) <code>0b&lt;abcd&gt;_&lt;efgh&gt;</code> ãªã©ã‚’ä¸‹ä½ bit ã‹ã‚‰å…ˆã«æ›¸ã„ã¦ <code>0q&lt;hgfe&gt;~&lt;dcba&gt;</code> ãªã©ã¨æ›¸ãã“ã¨ã«ã™ã‚‹. (æ•°å­¦è€…ã‹ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã®æ°—æŒã¡.)</p>
<p>$X$ ã® $i$ bit ç›®ã‚’ $X_i$ ã§è¡¨ã™.</p>
<p>$$
\begin{align*}
xy
&amp;= x \left( \sum_{i=0}^{\infty} 2^i y_i \right) \\
&amp;= \sum_{i=0}^{\infty} (2^i x) y_i
\end{align*}
$$</p>
<p>æ„šç›´ã«ã‚„ã‚‹ã¨ n bit ä¹—ç®—ã¯ n å›å’Œã‚’å–ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã‚‹. (å›ºå®š bit ã‚·ãƒ•ãƒˆã¯ã‚¿ãƒ€ã¿ãŸã„ãªã‚‚ã®ãªã®ã§å¿˜ã‚Œã‚‹.)
<a href="https://en.wikipedia.org/wiki/Modular_exponentiation">modexp</a> ã¿ãŸã„ãªæ„Ÿã˜ã§ã™ã­.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># 8-bit ä¹—ç®—
</span><span>def mul8(x: int, y: int):
</span><span>    r = 0
</span><span>    for i in range(0, 8):
</span><span>        print(i, x, y, r)
</span><span>        y_ = y &amp; 0b1
</span><span>        a: int
</span><span>        if y_ == 0b0:
</span><span>            a = 0
</span><span>        elif y_ == 0b1:
</span><span>            a = x
</span><span>        r += a
</span><span>        x = x &lt;&lt; 1
</span><span>        y = y &gt;&gt; 1
</span><span>    return r
</span></code></pre>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>&gt;&gt;&gt; mul8(10, 224 + 6)
</span><span>0 10 230 0
</span><span>1 20 115 0
</span><span>2 40 57 20
</span><span>3 80 28 60
</span><span>4 160 14 60
</span><span>5 320 7 60
</span><span>6 640 3 380
</span><span>7 1280 1 1020
</span><span>2300
</span></code></pre>
<p>ãƒ«ãƒ¼ãƒ—å›æ•°ã¨å’Œã‚’æ¸›ã‚‰ã—ãŸã„. (å›è·¯ã«è½ã¨ã™ãŸã‚, å’Œã‚’ã—ãªã„å ´åˆã¯ 0 ã‚’è¶³ã™ã¨è¦‹åšã™.)</p>
<h2 id="booth-noarugorizumu">Booth ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </h2>
<p>ã¨ã“ã‚ã§ <code>y = 0q1110~0000</code> ã®æ§˜ã«1ãŒé€£ç¶šã—ã¦ã„ã‚‹éƒ¨åˆ†ãŒã²ã¨ã¤ã®ã¨ãã¯ã‚‚ã£ã¨ç°¡å˜ã§ã‚ã‚‹.</p>
<p>$$
\begin{align*}
y
&amp;= 2^0 + 2^1 + 2^2 \\
&amp;= 2^3 - 2^0       \\
xy
&amp;= 2^0 (-x) + 2^3 x
\end{align*}
$$</p>
<p>$-x$ ã‚’äº‹å‰è¨ˆç®—ã—ã¦ãŠã„ã¦ $x, -x$ ã‚’ã‚·ãƒ•ãƒˆã—ã¦ã„ã‘ã°å’ŒãŒ2å›ã«ãªã£ãŸ.</p>
<p><code>y = 0q0011~1100</code> ã®æ§˜ã«ä½ç½®ã‚„å¹…ãŒå¤‰ã‚ã£ã¦ã‚‚åŒã˜ã§ã‚ã‚‹.</p>
<p>$$
\begin{align*}
y
&amp;= 2^2 + 2^3 + 2^4 + 2^5 \\
&amp;= 2^6 - 2^2             \\
xy
&amp;= 2^2 (-x) + 2^6 x
\end{align*}
$$</p>
<p><code>y = 0q0110~0111</code> ã®æ§˜ã«1ãŒé€£ç¶šã™ã‚‹éƒ¨åˆ†ãŒè¤‡æ•°ã‚ã‚‹å ´åˆ, <code>y' = 0q0110~0000</code> ã¨ <code>y'' = 0q0000~0111</code> ã«åˆ†ã‘ã¦è¨ˆç®—ã™ã‚Œã°ã‚ˆã„.</p>
<p>$$
xy = x (y' + y'') = 2^1 (-x) + 2^3 x + 2^5 (-x) + 2^8 x
$$</p>
<p>ã¤ã¾ã‚Šä¸€èˆ¬ã«, ç«‹ã¡ä¸ŠãŒã‚Š <code>0q01</code> ã®ã¨ãã¯ã‚·ãƒ•ãƒˆã—ãŸ $-x$ ã‚’è¶³ã—, ç«‹ã¡ä¸‹ãŒã‚Š <code>0q10</code> ã®ã¨ãã¯ã‚·ãƒ•ãƒˆã—ãŸ $x$ ã‚’è¶³ã›ã°ã‚ˆã„.</p>
<p>2-bit ãšã¤è¦‹ã¦ã„ãå ´åˆã¯ä»¥ä¸‹ã®æ§˜ã«ãªã‚‹.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># 8-bit ä¹—ç®—, Booth ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ , å¹… 2
</span><span>def mul8_booth2(x: int, y: int):
</span><span>    mx = -x
</span><span>    # y ã® 0 bit ç›®ã‚’ä¸‹ã® i = 0 ã®ã¨ãã® 0b10 ã§è¶³ã—è¾¼ã¿ãŸã„ã®ã§ä»®æƒ³çš„ãª -1 bit ç›®ã‚’å€¤ 0 ã§è¿½åŠ .
</span><span>    y = y &lt;&lt; 1
</span><span>    r = 0
</span><span>    # y ã® -1 bit ç›®ã‚’è¶³ã—ãŸã®ã§ãƒ«ãƒ¼ãƒ—å›æ•°ã¯1å›å¢—ãˆã‚‹.
</span><span>    for i in range(0, 9):
</span><span>        print(i, x, mx, y, r)
</span><span>        y_ = y &amp; 0b11
</span><span>        a: int
</span><span>        if y_ == 0b00:
</span><span>            a = 0
</span><span>        elif y_ == 0b01:
</span><span>            a = x
</span><span>        elif y_ == 0b10:
</span><span>            a = mx
</span><span>        elif y_ == 0b11:
</span><span>            a = 0
</span><span>        r += a
</span><span>        x = x &lt;&lt; 1
</span><span>        mx = mx &lt;&lt; 1
</span><span>        y = y &gt;&gt; 1
</span><span>    return r
</span></code></pre>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>&gt;&gt;&gt; mul8_booth2(10, 224 + 6)
</span><span>0 10 -10 460 0
</span><span>1 20 -20 230 0
</span><span>2 40 -40 115 -20
</span><span>3 80 -80 57 -20
</span><span>4 160 -160 28 60
</span><span>5 320 -320 14 60
</span><span>6 640 -640 7 -260
</span><span>7 1280 -1280 3 -260
</span><span>8 2560 -2560 1 -260
</span><span>2300
</span></code></pre>
<p>ã“ã‚Œã ã¨ã¾ã ãƒ«ãƒ¼ãƒ—å›æ•°ã¯æ¸›ã£ã¦ã„ãªã„. å¹…ã‚’ 3 ã«ã—ã‚ˆã†. å…ˆç¨‹ã¨ã¯é•ã„, ç«‹ã¡ä¸ŠãŒã‚Šã¨ç«‹ã¡ä¸‹ãŒã‚ŠãŒåŒæ™‚ã«èµ·ãå¾—ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹. (<code>0q010</code> ã¨ <code>0q101</code>.)</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># 8-bit ä¹—ç®—, Booth ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ , å¹… 3
</span><span>def mul8_booth3(x: int, y: int):
</span><span>    mx = -x
</span><span>    y = y &lt;&lt; 1
</span><span>    r = 0
</span><span>    for i in range(0, 5):
</span><span>        print(i, x, mx, y, r)
</span><span>        y_ = y &amp; 0b111
</span><span>        a: int
</span><span>        if y_ == 0b000:
</span><span>            a = 0
</span><span>        elif y_ == 0b001:
</span><span>            a = x
</span><span>        elif y_ == 0b010:
</span><span>            # a = (x &lt;&lt; 1) + mx
</span><span>            a = x
</span><span>        elif y_ == 0b011:
</span><span>            a = (x &lt;&lt; 1)
</span><span>        elif y_ == 0b100:
</span><span>            a = (mx &lt;&lt; 1)
</span><span>        elif y_ == 0b101:
</span><span>            # a = (mx &lt;&lt; 1) + x
</span><span>            a = mx
</span><span>        elif y_ == 0b110:
</span><span>            a = mx
</span><span>        elif y_ == 0b111:
</span><span>            a = 0
</span><span>        r += a
</span><span>        x = x &lt;&lt; 2
</span><span>        mx = mx &lt;&lt; 2
</span><span>        y = y &gt;&gt; 2
</span><span>    return r
</span></code></pre>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>&gt;&gt;&gt; mul8_booth3(10, 224 + 6)
</span><span>0 10 -10 460 0
</span><span>1 40 -40 115 -20
</span><span>2 160 -160 28 60
</span><span>3 640 -640 7 -260
</span><span>4 2560 -2560 1 -260
</span><span>2300
</span></code></pre>
<p>ã“ã‚Œã§ãƒ«ãƒ¼ãƒ—ã¨å’Œã®å›æ•°ãŒåŠåˆ†ã«ãªã£ãŸ. ã“ã‚ŒãŒ <strong>Booth ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </strong> ã§ã‚ã‚‹.</p>
<p>ä¹—ç®—å™¨ã§ã¯ BCLA ã§ã¯ãªã Carry Save Adder (CSA) ã‚’ç”¨ã„ã‚‹ã¨ã„ã£ãŸã“ã¨ã¯æœ¬æ›¸å‚ç…§.</p>

    </div>
</article>

            </main>
            <footer>
                <div class="footer">
                    <small class="footer-left">
                        Â© 2021--2024. All rights reserved.
                    </small>
                    <small class="footer-right">
                        Powered by <a href="https://www.getzola.org">Zola</a>
                    </small>
                </div>
            </footer>
        </div>
    </body>
</html>
