<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>
crate thin_delegate ã‚’æ›¸ã„ãŸ (3&#x2F;4) | å†·ãŸãæ²¢ã®å²©é™°ã®
</title>

        
<meta property="og:image" content="https:&#x2F;&#x2F;kenoss.github.io&#x2F;ogp.jpg" />
<meta property="og:title" content="crate thin_delegate ã‚’æ›¸ã„ãŸ (3&#x2F;4)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https:&#x2F;&#x2F;kenoss.github.io&#x2F;blog&#x2F;2025-01-04-thin_delegate-3&#x2F;" />

<meta property="og:site_name" content="å†·ãŸãæ²¢ã®å²©é™°ã®" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@keno_ss" />


        



        <link rel="stylesheet" href="https://kenoss.github.io/theme.css">
    </head>
    <body>
        <div class="content">
            <header>
                <div class="header-left">
                    <a href="https:&#x2F;&#x2F;kenoss.github.io" class="header-logo">å†·ãŸãæ²¢ã®å²©é™°ã®</a>
                </div>
                <div class="header-right">
                </div>
            </header>
            <main>
                
<article itemscope itemtype="http://schema.org/BlogPosting">
    <div class="headline" itemprop="headline">
        <h1 class="post-title">crate thin_delegate ã‚’æ›¸ã„ãŸ (3&#x2F;4)</h2>
        <div class="border"></div>
        <div>
            <time datetime="2025-01-04" class="post-date" itemprop="datePublished">
                2025-01-04
            </time>
            
                |
                
                    <span class="post-tag">ğŸ¦€ rust</span>
                
                    <span class="post-tag">ğŸ¦€ tech</span>
                
                    <span class="post-tag">ğŸ¦€ thin_delegate</span>
                
                        
        </div>
    </div>
    <div itemprop="articleBody">
        <ul>
<li><a href="../2025-01-02-thin_delegate-1">1ç« : <code>thin_delegate</code> ã®ç´¹ä»‹</a></li>
<li><a href="../2025-01-03-thin_delegate-2">2ç« : proc macro é–“ã§ã®æƒ…å ±ä¼é”ã¨ delegation crate æ¯”è¼ƒ</a></li>
<li><a href="../2025-01-04-thin_delegate-3">3ç« : <code>thin_delegate</code> ã®è¨­è¨ˆã¨å®Ÿè£…</a>
<ul>
<li><a href="https://kenoss.github.io/blog/2025-01-04-thin_delegate-3/./#proc-macro-crate-should-use-trybuild">proc macro crate ã¯ <code>trybuild</code> ã‚’ä½¿ã†ã¹ãã§ã‚ã‚‹</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-04-thin_delegate-3/./#direction-of-thin_delegate">thin_delegate ã®åŸºæœ¬æ–¹é‡</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-04-thin_delegate-3/./#syntax-of-thin-delegate">thin_delegate ã®æ§‹æ–‡</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-04-thin_delegate-3/./#implementation-of-thin_delegate">thin_delegate ã®å®Ÿè£…</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-04-thin_delegate-3/./#other-techniques">ãã®ä»–ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-04-thin_delegate-3/./#summary">3ç« ã¾ã¨ã‚</a></li>
</ul>
</li>
<li><a href="../2025-01-05-thin_delegate-4">4ç« : ã¾ã¨ã‚</a></li>
</ul>
<h2 id="chapter-3">3ç« : <code>thin_delegate</code> ã®è¨­è¨ˆã¨å®Ÿè£…</h2>
<p>1ç« ã§ã¯åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’è¦‹, 2ç« ã§ã¯å®Ÿè£…ã®ã²ã¨ã¤ã®ã‚³ã‚¢ã§ã‚ã‚‹ proc macro é–“ã§ã®æƒ…å ±ä¼é”æ–¹æ³•ã‚’æ¯”è¼ƒã—ã¾ã—ãŸ.
thin_delegate ã¯ãã®ã†ã¡ <strong>proc macro ä¸­ã§ decl macro ã‚’çµŒç”±ã™ã‚‹</strong> æ–¹æ³•ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™.
ã“ã®ç« ã§ã¯ <strong>thin_delegate ã®è¨­è¨ˆãŠã‚ˆã³å®Ÿè£…</strong> ã®æ®‹ã‚Šã®éƒ¨åˆ†ã‚’æ˜ã‚Šä¸‹ã’ã¾ã™.
ã¾ãŸ <strong>trait method ã®è‡ªå‹• delegation ã®æ§‹æ–‡</strong> ã«ã¤ã„ã¦ã‚‚è­°è«–ã—ã¾ã™.</p>
<h3 id="proc-macro-crate-should-use-trybuild">proc macro crate ã¯ <code>trybuild</code> ã‚’ä½¿ã†ã¹ãã§ã‚ã‚‹</h3>
<p>æœ¬é¡Œã«å…¥ã‚‹å‰ã«ã²ã¨ã¤è¨€ã£ã¦ãŠããŸã„ã“ã¨ãŒã‚ã‚Šã¾ã™.
<strong>proc macro crate ã¯ <a href="https://github.com/dtolnay/trybuild"><code>trybuild</code></a> ã‚’ä½¿ã†ã¹ã</strong> ã§ã™.
ã‚‚ã£ã¨è¨€ã†ã¨, <strong>æ­£å¸¸ç³»ä»¥å¤–ã‚‚ã¡ã‚ƒã‚“ã¨ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¹ã</strong> ã§ã™.</p>
<p>proc macro ã¯é»’é­”è¡“ã‚’èª°ã§ã‚‚è¡Œä½¿ã§ãã‚‹ã‚ˆã†ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ãŸã‚‚ã®ã§ã™ <sup class="footnote-reference"><a href="#301">1</a></sup>.
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ•´å‚™ã™ã‚‹ã®ã¯å½“ç„¶ã§ã™ãŒ, ã‚‚ã†ã²ã¨ã¤å¤§äº‹ãªã®ã¯ã‚¨ãƒ©ãƒ¼ã§ã™.
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’éš…ã‹ã‚‰éš…ã¾ã§èª­ã‚€ã“ã¨ã¯æœŸå¾…ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“.
æ¦‚è¦ã‚’èª­ã‚€ãã‚‰ã„ã¯æœŸå¾…ã—ãŸã„ã¨ã“ã‚ã§ã™ãŒ,
å¹³å‡çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã®å¾Œå®Ÿéš›ã« crate ã‚’ä½¿ã£ã¦ã¿ã¦, ã‚·ãƒ³ãƒ—ãƒ«ãªã‚±ãƒ¼ã‚¹ã‹ã‚‰å§‹ã‚ã¦è‡ªåˆ†ãŒæœ¬å½“ã«ã‚„ã‚ŠãŸã„å½¢ã«è¿‘ã¥ã‘ã¦ã„ãã¾ã™.
ãã®é“ä¸­ã®ç¯€ã€…ã§ã‚¨ãƒ©ãƒ¼ã«å‡ºãã‚ã—, ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã—ãªãŒã‚‰é€²ã‚“ã§ã„ãã¾ã™.
å…¸å‹çš„ã«ã¯ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -&gt; Web æ¤œç´¢ -&gt; ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ -&gt; ãƒ†ã‚¹ãƒˆ ã®é †ã«è¦‹ã¦è¡Œãã¨æ€ã£ã¦ãŠã‘ã°ã‚ˆã„ã§ã—ã‚‡ã†.
ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æœ€åˆã«ç›®ã«ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ãŸã‚, è¦ªåˆ‡ã§ã‚ã‚Œã°ã‚ã‚‹ã»ã©è‰¯ã„ã§ã™.
ä¸€èˆ¬ã«, å¯èƒ½ãªå ´åˆã¯ <strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è§£æ±ºã‚’æ±‚ã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€™è£œã‚’æ˜ç¤ºã™ã‚‹ã¹ã</strong> ã§ã™.</p>
<p>trybuild ã‚’ä½¿ã†ã“ã¨ã§æ¬¡ã®ãƒ†ã‚¹ãƒˆãŒã§ãã¾ã™:</p>
<ul>
<li>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚‹ã‚±ãƒ¼ã‚¹. å®Ÿè¡Œæ™‚ã®æŒ™å‹•ã‚‚ãƒ†ã‚¹ãƒˆã§ãã‚‹.</li>
<li>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚‰ãªã„ã‚±ãƒ¼ã‚¹. ã©ã®æ§˜ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã«ãªã‚‹ã®ã‹ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹.
<ul>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé™¥ã‚Šã‚„ã™ã„ã‚±ãƒ¼ã‚¹ã«ã©ã®æ§˜ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹.
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒªãƒã‚¸ãƒˆãƒªã‚’ grep ã—ãŸã‚Šãƒ†ã‚¹ãƒˆã‚’çœºã‚ã‚‹ã“ã¨ã§ã“ã“ã«è¾¿ã‚Šã¤ãã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹.</li>
<li>ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„æ©Ÿèƒ½ã®æ˜ç¤º.
ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ limitation ã¨ã‹ unsupported ã¨ã‹ã§çµ±ä¸€ã—ã¦ãŠã‘ã°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠŠæ¡ã—ã‚„ã™ããªã‚Šã¾ã™.
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ãƒªãƒ³ã‚¯ã‚’è²¼ã‚Œã°ã‚ˆã‚Šè‰¯ã„ã§ã™.</li>
</ul>
</li>
<li>panic ã—ãªã„ã“ã¨</li>
</ul>
<p>ã¾ãã—ã‹ã—, proc macro å´ãŒã„ãã‚‰é ‘å¼µã£ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ”¹å–„ã—ã‚ˆã†ãŒãªã„ã‚±ãƒ¼ã‚¹ã‚‚å¤šã€…ã‚ã‚Šã¾ã™.
ãã†ã„ã†ã¨ãã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ä¾‹ç¤ºã ã‘ã—ã¦è«¦ã‚ã¾ã—ã‚‡ã†. é€†ã«ã“ã®ã‚±ãƒ¼ã‚¹ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé ‘å¼µã‚‹ã¹ãã§ã™.
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã ã‚Š <code>cargo expand</code> ã—ã¾ã—ã‚‡ã†.</p>
<h3 id="direction-of-thin_delegate">thin_delegate ã®åŸºæœ¬æ–¹é‡</h3>
<p>proc macro ã®ç›®çš„ã«ã¯ã„ãã¤ã‹ã®ç³»çµ±ãŒã‚ã‚Šã¾ã™. é›‘ã«åˆ†é¡ã—ã¦ã¿ã¾ã—ã‚‡ã†.</p>
<ul>
<li>trait ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…ã‚’åŸ‹ã‚ã‚‹
<ul>
<li>derive macro, e.g. <code>#[derive(Debug, Clone, Copy, PartialEq, Eq, serde::Deserialize)]</code></li>
</ul>
</li>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå±•é–‹ç³»ã‚’æƒ³åƒã§ãã‚‹ã‚‚ã®ã‚’æ¥½ã«ç”Ÿæˆã™ã‚‹
<ul>
<li><code>#[derive(derive_more::From)]</code> [<a href="https://docs.rs/derive_more/latest/derive_more/derive.From.html">doc</a>]</li>
<li><code>#[derive(getset::Getters, getset::Setters)]</code> [<a href="https://docs.rs/getset/latest/getset/">doc</a>]</li>
<li><code>#[derive(derive_builder::Builder)]</code> [<a href="https://docs.rs/derive_builder/latest/derive_builder/">doc</a>]</li>
<li><code>#[thin_delegate::fill_delegate]</code> [<a href="https://docs.rs/thin_delegate/latest/thin_delegate/attr.fill_delegate.html">doc</a>]</li>
<li><code>seq!</code> [<a href="https://github.com/dtolnay/proc-macro-workshop?tab=readme-ov-file#function-like-macro-seq">README</a>]</li>
</ul>
</li>
<li>æ§‹é€ ä½“å®šç¾©ã® DSL
<ul>
<li><code>#[derive(thiserror::Erorr)]</code> [<a href="https://docs.rs/thiserror/latest/thiserror/">doc</a>]</li>
<li><code>#[bitfield]</code> [<a href="https://github.com/dtolnay/proc-macro-workshop?tab=readme-ov-file#attribute-macro-bitfield">README</a>]</li>
</ul>
</li>
<li>åˆ¶ç´„ã‚’å®ˆã‚‰ã›ã‚‹
<ul>
<li><code>#[sorted]</code> [<a href="https://github.com/dtolnay/proc-macro-workshop?tab=readme-ov-file#attribute-macro-sorted">README</a>]</li>
<li><code>#[remain]</code> [<a href="https://docs.rs/remain/latest/remain/">doc</a>]</li>
</ul>
</li>
<li>ä¸‹å±¤ã®ä»•çµ„ã¿ã®éš è”½
<ul>
<li><code>invently::submit!</code> [<a href="https://github.com/dtolnay/inventory">repo</a>]</li>
<li><code>#[distributed_slice]</code> [<a href="https://github.com/dtolnay/linkme">repo</a>]</li>
</ul>
</li>
</ul>
<p>thin_delegate ã¯ <strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå±•é–‹ç³»ã‚’æƒ³åƒã§ãã‚‹ã‚‚ã®ã‚’æ¥½ã«ç”Ÿæˆã™ã‚‹</strong> ã«å±ã—ã¾ã™.
ã“ã®ã‚±ãƒ¼ã‚¹ã§ã¯æ§‹æ–‡ã‚‚æŒ™å‹•ã‚‚å¯èƒ½ãªé™ã‚Šã‚·ãƒ³ãƒ—ãƒ«ã§ã‚ã‚‹ã¹ãã¨åƒ•ã¯æ€ã£ã¦ã„ã¾ã™. ä½•æ•…ãªã‚‰è¤‡é›‘ã«ã™ã‚‹ã¨æƒ³åƒãŒåŠ¹ã‹ãªããªã‚‹/å¤–ã‚Œã‚‹ã‹ã‚‰ã§ã™.
ä»¥ä¸‹ã§ã¯ã“ã‚Œã‚’å¿µé ­ã«ç½®ã„ã¦ãŠãã¾ã™.</p>
<h3 id="syntax-of-thin-delegate">thin_delegate ã®æ§‹æ–‡</h3>
<p>ã•ã¦, æœ¬é¡Œã«å…¥ã‚Šã¾ã—ã‚‡ã†. ã¾ãšã¯æ§‹æ–‡ã‚’æ±ºã‚ã¦ãŠãã¾ã—ã‚‡ã†.</p>
<p>thin_delegate ã¯ enum_delegate, ambassador, delegate (, portrait) ã‹ã‚‰å¤§ããªå½±éŸ¿ã‚’å—ã‘ã¦ã„ã¾ã™.
ã“ã“ã§ã¯ thin_delegate ãŒä½•æ•…ã“ã®æ§‹æ–‡ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã®ã‹ã‚’, ä»–ã¨æ¯”è¼ƒã—ãªãŒã‚‰èª¬æ˜ã—ã¦ã„ãã¾ã™.</p>
<h4 id="attr-macro-on-impl-trait-for"><code>impl Trait for StructEnum {...}</code> ã«ä»˜ã‘ã‚‹</h4>
<p>åŸºæœ¬çš„ãªæ§‹æ–‡ã¯ä»¥ä¸‹ã®æ§˜ãªã‚‚ã®ã§ã—ãŸ:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>] </span><span style="color:#65737e;">// (1-2)
</span><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>] </span><span style="color:#65737e;">// (1-3)
</span><span style="color:#b48ead;">struct </span><span>Window {
</span><span>    </span><span style="color:#bf616a;">rect</span><span>: Rect,
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">fill_delegate</span><span>]
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Window {} </span><span style="color:#65737e;">// (1-4)
</span></code></pre>
<p>(1-2), (1-3), (1-4) ã§ä½•ãŒèµ·ã“ã‚‹ã‹ã‚’æƒ³åƒã§ãã¾ã™ã‹?</p>
<ul>
<li><code>#[thin_delegate::register]</code> ã¯ trait/struct/enum ã®å®šç¾©ã‚’å¾Œã§ä½¿ãˆã‚‹ã‚ˆã†ã«ç™»éŒ²ã™ã‚‹.</li>
<li><code>#[thin_delegate::fill_delegate]</code> ã¯ <code>impl Trait for StructEnum {...}</code> ã®ã†ã¡æœªå®šç¾©ãª trait method ã‚’åŸ‹ã‚ã‚‹.</li>
</ul>
<p>åŸºæœ¬çš„ã«ã¯ã“ã‚Œã ã‘ã§ã™.</p>
<p>ä¼¼ãŸæ§˜ãªã“ã¨ã‚’ ambassador ã§ã‚„ã‚‹ã¨ä»¥ä¸‹ã®æ§˜ã«ãªã‚Šã¾ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">ambassador</span><span>::</span><span style="color:#bf616a;">delegatable_trait</span><span>]
</span><span style="color:#b48ead;">trait </span><span>Shout&lt;T&gt;
</span><span style="color:#65737e;">// ã“ã‚Œã‚’ä»˜ã‘ã‚‹ã¨é§„ç›®
</span><span style="color:#65737e;">// where
</span><span style="color:#65737e;">//     T: std::fmt::Display,
</span><span>{
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">shout</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">input</span><span>: T) -&gt; String;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl</span><span>&lt;T&gt; Shout&lt;T&gt; </span><span style="color:#b48ead;">for </span><span>String
</span><span style="color:#b48ead;">where
</span><span>    T: std::fmt::Display,
</span><span>{
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">shout</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">input</span><span>: T) -&gt; String {
</span><span>        format!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">, </span><span style="color:#d08770;">{}</span><span>&quot;, </span><span style="color:#bf616a;">self</span><span>, input)
</span><span>    }
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(ambassador::Delegate)]
</span><span>#[</span><span style="color:#bf616a;">delegate</span><span>(Shout&lt;T&gt;, generics = &quot;</span><span style="color:#a3be8c;">T</span><span>&quot;, where = &quot;</span><span style="color:#a3be8c;">T: std::fmt::Display</span><span>&quot;)]
</span><span style="color:#b48ead;">pub struct </span><span>Cat(String);
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(ambassador::Delegate)]
</span><span>#[</span><span style="color:#bf616a;">delegate</span><span>(Shout&lt;T&gt;, generics = &quot;</span><span style="color:#a3be8c;">T</span><span>&quot;, where = &quot;</span><span style="color:#a3be8c;">T: std::fmt::Display</span><span>&quot;)]
</span><span style="color:#b48ead;">enum </span><span>Animal {
</span><span>    Cat(Cat),
</span><span>}
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let</span><span> cat = Cat(&quot;</span><span style="color:#a3be8c;">meow</span><span>&quot;.</span><span style="color:#96b5b4;">to_string</span><span>());
</span><span>    assert_eq!(cat.</span><span style="color:#96b5b4;">shout</span><span>(&quot;</span><span style="color:#a3be8c;">world</span><span>&quot;), &quot;</span><span style="color:#a3be8c;">meow, world</span><span>&quot;);
</span><span>    </span><span style="color:#b48ead;">let</span><span> animal = Animal::Cat(cat);
</span><span>    assert_eq!(animal.</span><span style="color:#96b5b4;">shout</span><span>(&quot;</span><span style="color:#a3be8c;">world</span><span>&quot;), &quot;</span><span style="color:#a3be8c;">meow, world</span><span>&quot;);
</span><span>}
</span></code></pre>
<p>ä½•æ•… <code>#[derive(ambassador::Delegate)]</code> ã¨ <code>[delegate(...)]</code> ãŒåˆ†ã‹ã‚Œã¦ã„ã‚‹ã®ã‹ã‚„,
generics/trait bound ã®æŒ‡å®šã®ä»•æ–¹ãªã©, ã±ã£ã¨ã‚ã‹ã‚Šã«ãã„ã¨æ€ã„ã¾ã™.</p>
<p>ã™ãã‚ã‹ã‚‹å·®åˆ†ã¯æ¬¡ã®ã¿ã£ã¤ã§ã™:</p>
<ol>
<li><code>#[thin_delegate::fill_delegate]</code> ã¯ <code>impl Trait for StructEnum {...}</code> ã«ä»˜ã‘ã‚‹.
ambassador ã® <code>#[delegate(...)]</code> ã¯ struct/enum ã«ä»˜ã‘ã‚‹.</li>
<li>ambassador ã§ã¯ <code>#[derive(ambassador::Delegate)]</code> ã¨ <code>[delegate(...)]</code> ã®ä¸¡æ–¹ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹.</li>
<li>thin_delegate ã§ã¯ generics ã®æŒ‡å®šã®ãŸã‚ã®è¿½åŠ ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ãªã„.
ambassador ã¯ <code>#[delegate(...)]</code> ã®ä¸­ã§æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹.</li>
</ol>
<p>ã“ã‚Œã‚‰ã¯å¯†æ¥ã«çµ¡ã¿åˆã£ã¦ã„ã¾ã™.</p>
<p>ã¾ãš 2. ã§ã™ãŒ, (1. ambassador ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã®ä¸‹ã§ã¯) struct/enum ã«å¯¾ã—ã¦è¤‡æ•°ã® trait ã‚’è‡ªå‹• delegate
ã•ã›ã‚‹ãŸã‚ã«ã¯ä»¥ä¸‹ã®æ§˜ã«æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">derive</span><span>(ambassador::Delegate)]
</span><span>#[</span><span style="color:#bf616a;">delegate</span><span>(Shout&lt;T&gt;, generics = &quot;</span><span style="color:#a3be8c;">T</span><span>&quot;, where = &quot;</span><span style="color:#a3be8c;">T: std::fmt::Display</span><span>&quot;)]
</span><span>#[</span><span style="color:#bf616a;">delegate</span><span>(Walk)]
</span><span style="color:#b48ead;">enum </span><span>Animal {
</span><span>    Cat(Cat),
</span><span>}
</span></code></pre>
<p>ã“ã®ãŸã‚ <code>#[derive(ambassador::Delegate)]</code> ã¨ <code>[delegate(...)]</code> ã‚’åˆ†ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ <sup class="footnote-reference"><a href="#302">2</a></sup>.</p>
<p>ãã†ãªã®ã§ã™. ã“ã®å•é¡Œã‚’ã€Œ<code>impl Trait for StructEnum {...}</code> ã‚’åŸ‹ã‚ã‚‹ã€å•é¡Œã ã¨èªè­˜ã—ã•ãˆã™ã‚Œã°,
ã“ã® macro ã¯ trait <code>Trait</code> ã¨ struct/enum <code>StructEnum</code> ã®çµ„ <code>(Trait, StructEnum)</code>
ã«å¯¾ã—ã¦è¨˜è¿°/å‹•ä½œã™ã‚‹ã®ãŒè‡ªç„¶ (1.) ã ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™. ãã†ã™ã‚‹ã¨å¾Œã®ãƒ‡ã‚¶ã‚¤ãƒ³ã¯ã»ã¼ä¸€ç›´ç·šã§ã™.</p>
<p><a href="https://doc.rust-lang.org/reference/procedural-macros.html#r-macro.proc.derive.intro">derive macro ã¯ struct/enum/union ã«ã—ã‹ä»˜ã‘ã‚‰ã‚Œã¾ã›ã‚“</a>.
ãªã®ã§ thin_delegate ã§ã¯æ™®é€šã® proc macro ã§å®Ÿè£…ã—ã¦ã„ã¾ã™ <sup class="footnote-reference"><a href="#303">3</a></sup>.</p>
<p>3.ã®é¸æŠã‚‚ (å°‘ãªãã¨ã‚‚æ§‹æ–‡çš„ã«ã¯) ãã“ã‹ã‚‰å¾“ã„ã¾ã™. <code>impl Trait for StructEnum {...}</code> ã«ä»˜ã‘ã‚‹ã®ã§ã‚ã‚Œã°
ã“ã® Rust ã®æ§‹æ–‡ã§è¨˜è¿°ã•ã‚Œã‚‹ generics/trait bound ã®æƒ…å ±ã‚’ä½¿ã†ã®ãŒæœ€ã‚‚è‡ªç„¶ã§ã—ã‚‡ã†.</p>
<p>ã“ã®é¸æŠã«ã‚ˆã‚Š <code>ambassador::Delegate</code> ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³
<a href="https://docs.rs/ambassador/latest/ambassador/derive.Delegate.html#delegate-where--a-debug---where-key"><code>where</code></a>
<a href="https://docs.rs/ambassador/latest/ambassador/derive.Delegate.html#delegateshoutx-generics--x---trait-generics"><code>generics</code></a>
<a href="https://docs.rs/ambassador/latest/ambassador/derive.Delegate.html#delegateshout-automatic_where_clause--false---inhibit-automatic-generation-of-where-clause"><code>automatic_where_clause</code></a>
ã¯ä¸è¦ã«ãªã‚Šã¾ã™ <sup class="footnote-reference"><a href="#304">4</a></sup>. æ®‹ã‚Šã¯
<a href="https://docs.rs/ambassador/latest/ambassador/derive.Delegate.html#delegate-target--foo---target-key"><code>target</code></a>
ã ã‘ã§ã™.</p>
<h4 id="non-trivial-delegation">Non trivial delegation</h4>
<p>ambassador ã® <code>target</code> ã¯æ¬¡ã®æ§˜ã« delegate ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸€æ„ã«å®šã¾ã‚‰ãªã„å ´åˆã«ä½¿ã„ã¾ã™:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">derive</span><span>(ambassador::Delegate)]
</span><span>#[</span><span style="color:#bf616a;">delegate</span><span>(Walk, target = &quot;</span><span style="color:#a3be8c;">foo</span><span>&quot;)] </span><span style="color:#65737e;">// &lt;-------- Delegate implementation of Shout to struct field .foo
</span><span style="color:#b48ead;">pub struct </span><span>MultiFieldStruct {
</span><span>  </span><span style="color:#bf616a;">foo</span><span>: Cat,
</span><span>  </span><span style="color:#bf616a;">bar</span><span>: Cat,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(ambassador::Delegate)]
</span><span>#[</span><span style="color:#bf616a;">delegate</span><span>(Walk, target = &quot;</span><span style="color:#a3be8c;">1</span><span>&quot;)] </span><span style="color:#65737e;">// &lt;-------- Delegate implementation of Shout to second field
</span><span style="color:#b48ead;">pub struct </span><span>MultiFieldTuppleStruct(Cat, Cat);
</span></code></pre>
<p>ã“ã‚Œã‚’ã©ã†æ‰±ã†ã‹è©±ã®å‰ã«, ã‚‚ã†å°‘ã—ä¸€èˆ¬åŒ–ã—ã¾ã—ã‚‡ã†.</p>
<p>ã“ã®è¨˜äº‹ã§ã¯çµ„ <code>(Trait, StructEnum, trait_item)</code> ã§ <strong><code>trait_item</code> ãŒ trivial ã« delegation å¯èƒ½</strong> ã‚’ä»¥ä¸‹ã§å®šç¾©ã—ã¾ã™:</p>
<ul>
<li><code>trait_item</code> ãŒ trait function (method) ã§ã‚ã‚‹; and</li>
<li><code>StructEnum</code> ãŒ enum ã¾ãŸã¯ã²ã¨ã¤ã® field ã®ã¿ã‚’æŒã¤ struct ã§ã‚ã‚‹.</li>
</ul>
<p>ç”¨èªã‚’æ¿«ç”¨ã—ã¦å˜ã« <strong>trivial ã§ã‚ã‚‹</strong> ã¨ã‚‚è¨€ã†ã“ã¨ã«ã™ã‚‹.</p>
<p>ã•ã¦, thin_delegate ã¯ã€Œtrivial ãªã‚‚ã®ã¯ delegation ã§è‡ªå‹•ã«, ãã†ã§ãªã„ã‚‚ã®ã¯æ®µéšçš„ã«è‡ªç”±åº¦ã‚’ä¸Šã’ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã€ã—ã¦ã„ã¾ã™.
ãã®ãŸã‚ã®ãµãŸã¤ã®æ©Ÿèƒ½ãŒ <strong><code>scheme</code></strong> ã¨ <strong>æ‰‹å‹•å®Ÿè£…ã¸ã® fallback</strong> ã§ã™.</p>
<h4 id="arg-scheme">Argument <code>scheme</code></h4>
<p>thin_delegate ã¯ trivial ãªå ´åˆã¯ delegation ã«ã‚ˆã£ã¦ method ã‚’åŸ‹ã‚ã¾ã™ãŒ, <code>scheme</code> ã¯ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ç”Ÿæˆãƒ«ãƒ¼ãƒ«ã‚’å¼„ã‚Šã¾ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>]
</span><span style="color:#b48ead;">pub struct </span><span>MultiFieldStruct {
</span><span>  </span><span style="color:#bf616a;">foo</span><span>: Cat,
</span><span>  </span><span style="color:#bf616a;">bar</span><span>: Cat,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">fill_delegate</span><span>(scheme = |f| </span><span style="color:#bf616a;">f</span><span>(&amp;self.foo))]
</span><span style="color:#b48ead;">impl </span><span>Walk </span><span style="color:#b48ead;">for </span><span>MultiFieldStruct {}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>]
</span><span style="color:#b48ead;">pub struct </span><span>MultiFieldTuppleStruct(Cat, Cat);
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">fill_delegate</span><span>(scheme = |f| </span><span style="color:#bf616a;">f</span><span>(&amp;self.1))]
</span><span style="color:#b48ead;">impl </span><span>Walk </span><span style="color:#b48ead;">for </span><span>MultiFieldStruct {}
</span></code></pre>
<p>ã“ã®æ§‹æ–‡ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§è¤‡é›‘ãªå ´åˆã‚‚ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ãã‚‹ã®ãŒè‰¯ã„ã§ã™ã­.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">derive</span><span>(derive_more::From)]
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>]
</span><span style="color:#b48ead;">pub</span><span>(</span><span style="color:#b48ead;">crate</span><span>) </span><span style="color:#b48ead;">enum </span><span>Backend {
</span><span>    Udev(udev::UdevBackend),
</span><span>    #[</span><span style="color:#bf616a;">cfg</span><span>(feature = &quot;</span><span style="color:#a3be8c;">winit</span><span>&quot;)]
</span><span>    Winit(winit::WinitBackend),
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">fill_delegate</span><span>(
</span><span>    external_trait_def = crate::external_trait_def::smithay::wayland::buffer,
</span><span>    scheme = |f| {
</span><span>        match self {
</span><span>            Self::</span><span style="color:#bf616a;">Udev</span><span>(backend) =&gt; </span><span style="color:#bf616a;">f</span><span>(backend),
</span><span>            #[</span><span style="color:#bf616a;">cfg</span><span>(feature = &quot;</span><span style="color:#a3be8c;">winit</span><span>&quot;)]
</span><span>            Self::</span><span style="color:#bf616a;">Winit</span><span>(backend) =&gt; </span><span style="color:#bf616a;">f</span><span>(backend),
</span><span>        }
</span><span>    }
</span><span>)]
</span><span style="color:#b48ead;">impl </span><span>smithay::wayland::buffer::BufferHandler </span><span style="color:#b48ead;">for </span><span>Backend {}
</span></code></pre>
<p>ã“ã‚Œã¯ <code>delegate</code> crate ã®æ§‹æ–‡ã‚’ã©ã†ã‚„ã£ã¦ cryptic ã§ãªã„å½¢ã§çµ„ã¿è¾¼ã‚€ã‹ã‚’è€ƒãˆãŸçµæœã§ã™.</p>
<h4 id="fallback-to-manual-associated-items">æ‰‹å‹•å®Ÿè£…ã¸ã® fallback</h4>
<p>è‡ªå‹• delegation ã§ã‚‚ <code>scheme</code> ã§ã‚‚ associated const/type ã‚’æ‰±ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ <sup class="footnote-reference"><a href="#305">5</a></sup>.
<strong>1. æ‰‹å‹•ã®å®Ÿè£…ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹å ´åˆ, ãã‚Œã«ã¤ã„ã¦ã¯è‡ªå‹•ç”Ÿæˆã‚’ã—ãªã„, 2. trivial ã§ãªã„å ´åˆã¯è‡ªå‹•ç”Ÿæˆã‚’ã—ãªã„</strong>
ã¨ã™ã‚‹ã“ã¨ã§ã“ã®ã‚±ãƒ¼ã‚¹ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å§”ã­ã‚‹ã“ã¨ãŒã§ãã¾ã™:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>]
</span><span style="color:#b48ead;">trait </span><span>Hello {
</span><span>    </span><span style="color:#b48ead;">type </span><span>Return;
</span><span>
</span><span>    </span><span style="color:#b48ead;">const </span><span style="color:#d08770;">HAS_DEFAULT</span><span>: &amp;</span><span style="color:#b48ead;">&#39;static str </span><span>= &quot;</span><span style="color:#a3be8c;">HAS_DEFAULT</span><span>&quot;;
</span><span>    </span><span style="color:#b48ead;">const </span><span style="color:#d08770;">NEED_TO_FILL</span><span>: &amp;</span><span style="color:#b48ead;">&#39;static str</span><span>;
</span><span>
</span><span>    </span><span style="color:#65737e;">// `thin_delegate` only can fill associated functions.
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">filled</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">Self::</span><span>Return;
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">override_</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">Self::</span><span>Return;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Hello </span><span style="color:#b48ead;">for </span><span>String {
</span><span>    </span><span style="color:#b48ead;">type </span><span>Return = String;
</span><span>
</span><span>    </span><span style="color:#b48ead;">const </span><span style="color:#d08770;">NEED_TO_FILL</span><span>: &amp;</span><span style="color:#b48ead;">&#39;static str </span><span>= &quot;</span><span style="color:#a3be8c;">String</span><span>&quot;;
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">filled</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">Self::</span><span>Return {
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">clone</span><span>()
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">override_</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">Self::</span><span>Return {
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">clone</span><span>()
</span><span>    }
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>]
</span><span style="color:#b48ead;">struct </span><span>Hoge(String);
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">fill_delegate</span><span>]
</span><span style="color:#b48ead;">impl </span><span>Hello </span><span style="color:#b48ead;">for </span><span>Hoge {
</span><span>    </span><span style="color:#65737e;">// It can handle associated types in impl.
</span><span>    </span><span style="color:#65737e;">//
</span><span>    </span><span style="color:#65737e;">// You need to specify them by yourself as if you don&#39;t use `thin_delegate`.
</span><span>    </span><span style="color:#b48ead;">type </span><span>Return = String;
</span><span>
</span><span>    </span><span style="color:#65737e;">// It can handle associated consts in impl.
</span><span>    </span><span style="color:#65737e;">//
</span><span>    </span><span style="color:#65737e;">// You need to specify them by yourself as if you don&#39;t use `thin_delegate`.
</span><span>    </span><span style="color:#b48ead;">const </span><span style="color:#d08770;">NEED_TO_FILL</span><span>: &amp;</span><span style="color:#b48ead;">&#39;static str </span><span>= &quot;</span><span style="color:#a3be8c;">Hoge</span><span>&quot;;
</span><span>
</span><span>    </span><span style="color:#65737e;">// It can handle associated functions in impl.
</span><span>    </span><span style="color:#65737e;">//
</span><span>    </span><span style="color:#65737e;">// If an impl doesn&#39;t has an associated function (`filled()`), it is filled.
</span><span>    </span><span style="color:#65737e;">// If an impl has an associated function (`override_()`), it is used.
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">override_</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">Self::</span><span>Return {
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#d08770;">0.</span><span style="color:#96b5b4;">override_</span><span>().</span><span style="color:#96b5b4;">to_uppercase</span><span>()
</span><span>    }
</span><span>}
</span></code></pre>
<p>ã€Œassociated const/type ãŒä¸ãˆã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã«ãã‚Œã‚’ä½¿ã†ã€ã¨ã„ã†æŒ™å‹•ã¯ portrait ã®ã‚‚ã®ã‚’ç¶™æ‰¿ã—ã¦ã„ã¾ã™ <sup class="footnote-reference"><a href="#306">6</a></sup>.
thin_delegate ã¯ã‚ˆã‚Šå¼·ã, ã€Œä¸ãˆãªã‘ã‚Œã°ãªã‚‰ãªã„ã€ã§ã™.
(associated const
[<a href="https://github.com/kenoss/thin_delegate/blob/v0.1.0/tests/ui/fail_intended_limitation_associated_const_misning.rs">rs</a>]
[<a href="https://github.com/kenoss/thin_delegate/blob/v0.1.0/tests/ui/fail_intended_limitation_associated_const_misning.stderr">stderr</a>],
associated type
[<a href="https://github.com/kenoss/thin_delegate/blob/v0.1.0/tests/ui/fail_intended_limitation_associated_type_missing.rs">rs</a>]
[<a href="https://github.com/kenoss/thin_delegate/blob/v0.1.0/tests/ui/fail_intended_limitation_associated_type_missing.stderr">stderr</a>]
)</p>
<h4 id="arg-external_trait_def">Argument <code>external_trait_def</code></h4>
<p>ã•ã¦, ã“ã‚Œã§ç”Ÿæˆéƒ¨åˆ†ã¯è‰¯ã•ãã†ã§ã™. ã‚‚ã†ã²ã¨ã¤, ã€Œã©ã†ã‚„ã£ã¦å¤–éƒ¨ crate ã® trait å®šç¾©ã‚’å–ã‚Šè¾¼ã‚€ã‹ã€ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã™.</p>
<ol>
<li>å¤–éƒ¨ crate ã« <code>#[thin_delegate::register]</code> ç›¸å½“ãŒä»˜ã„ã¦ã„ã‚‹å ´åˆ</li>
<li>ä»˜ã„ã¦ã„ãªã„å ´åˆ</li>
</ol>
<p>ã®å¯¾å¿œã‚’è€ƒãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™.</p>
<p>ambassador ã§ã¯ <strong><code>Trait</code> ã¨åŒåã® decl macro ã‚’å®šç¾©ã™ã‚‹</strong> ã“ã¨ã§ 1. ã«å¯¾å¿œã—,
<a href="https://docs.rs/ambassador/latest/ambassador/attr.delegatable_trait_remote.html"><code>ambassador::delegatable_trait_remote</code></a>
ã¨ã„ã† attribute macro ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ 2. ã«å¯¾å¿œã—ã¦ã„ã¾ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">ambassador</span><span>::</span><span style="color:#bf616a;">delegatable_trait_remote</span><span>]
</span><span style="color:#b48ead;">trait </span><span>Display {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">fmt</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">f</span><span>: &amp;</span><span style="color:#b48ead;">mut </span><span>std::fmt::Formatter) -&gt; Result&lt;(), std::fmt::Error&gt;;
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(ambassador::Delegate)]
</span><span>#[</span><span style="color:#bf616a;">delegate</span><span>(Display)] </span><span style="color:#65737e;">// &lt;-------- Delegate implementation of Display to struct field
</span><span style="color:#b48ead;">pub struct </span><span>WrappedCat(Cat);
</span></code></pre>
<p>ã—ã‹ã—åƒ•ã¯ã“ã®è¨­è¨ˆã«ä»¥ä¸‹ã®ç†ç”±ã§åŒæ„ã§ãã¾ã›ã‚“:</p>
<ul>
<li>(2.) ä¸Šã§ã¯ <code>trait Display</code> ã¯å®Ÿéš›ã«ã¯å®šç¾©ã•ã‚Œãªã„. <code>#[ambassador::delegatable_trait_remote]</code>
ã¯ã€Œ<code>#[derive(ambassador:Delegate)]</code> ã«å®šç¾©ã‚’ä¼ãˆã‚‹ã ã‘ã€ã¨ã„ã†ã®ãŒã±ã£ã¨è¦‹ã§ã‚ã‹ã‚‰ãªã„.</li>
<li>(1., 2.) <a href="https://docs.rs/ambassador/latest/ambassador/attr.delegate_remote.html"><code>ambassador::delegate_remote</code></a>
ã‚‚ã‚ã‚Š, ã©ã†ä½¿ã„åˆ†ã‘ã‚Œã°ã„ã„ã®ã‹ã±ã£ã¨è¦‹ã§ã‚ã‹ã‚‰ãªã„ <sup class="footnote-reference"><a href="#307">7</a></sup>.</li>
<li>(1.) <code>pub</code> ãª macro ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æš—é»™ã§å®šç¾©ã—ã¦ã—ã¾ã†. æš—é»™ã®ã†ã¡ã« crate å´ã®å¥‘ç´„ãŒå¢—ãˆã‚‹.
<ul>
<li>ä¸Šæ‰‹ãå‹•ã‹ãªã„ã¨ãã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‡ãƒãƒƒã‚°ä¸èƒ½ [<a href="https://github.com/hobofan/ambassador/issues/45">issue#45</a>]</li>
<li>ambassador ã® version ãŒç•°ãªã‚‹ã¨ä½¿ãˆãªã„.</li>
<li>(1.) <a href="https://docs.rs/ambassador/latest/ambassador/#backwards-compatibility">backward compatibility</a>
ã¨ç ´å£Šçš„å¤‰æ›´ã«æ°—ã‚’é…ã‚‹å¿…è¦ãŒã‚ã‚‹. å®Ÿéš›ä¸Šè¨˜ã® issue ã«å¯¾å¿œã™ã‚‹ãŸã‚ã«ç ´å£Šçš„ãªå¤‰æ›´ãŒèµ·ã“ã£ã¦ãŠã‚Š
[<a href="https://github.com/hobofan/ambassador/pull/60/files">pr#60</a>], åˆ©ç”¨ã—ã¦ã„ã‚‹ crate ã¯ã“ã®ç ´å£Šçš„å¤‰æ›´ã‚’
ãã® crate è‡ªèº«ã®ç ´å£Šçš„å¤‰æ›´ã«æŒã¡ä¸Šã’ã‚‹å¿…è¦ãŒã‚ã‚‹.</li>
</ul>
</li>
<li>(1.) upstream crate ã« <code>register</code> ç”¨ã® attribute ãŒã¤ã„ã¦ã„ãªã„ã¨ã, 2. ã‚’ä½¿ã‚ãšã«æ¥½ã‚’ã™ã‚‹ãŸã‚ã«ã¯ upstream crate ã«
PR ã‚’ãƒãƒ¼ã‚¸ã—ã¦ãã‚Œã¨ãŠé¡˜ã„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹. èª¬å¾—ã‚³ã‚¹ãƒˆãŒé«˜ã™ãã‚‹. ä¸Šè¿°ã®å•é¡Œã‚‚ã‚ã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆã‚’å¢—ã‚„ã—ã¦ã—ã¾ã†ã®ã§
upstream crate å´ã¯ reject ã™ã‚‹ã®ã‚‚ã‚„ã‚€ãªã—.</li>
<li>(1.) 2. ã‚’ä½¿ã‚ãšã«ã‚³ãƒ”ãƒšãªã—ã§å…¨ã¦ãŒå‹•ãä¸–ç•Œã«è¡ŒããŸã‚ã«ã¯ delegation ç•Œã®è¦‡æ¨©ã‚’å–ã‚‹å¿…è¦ãŒã‚ã‚‹...ã©ã“ã‚ã‹,
å…¨ã¦ã® <code>pub</code> trait ã« <strong>äº‹å‰ã«</strong> ä»˜ã‘ã¦ãŠãå¿…è¦ãŒã‚ã‚‹. éç¾å®Ÿçš„ã§ã‚ã‚‹.</li>
</ul>
<p>ä»¥ä¸Šã®ç†ç”±ã‹ã‚‰, thin_delegate ã¯ 1. ã‚’ç¦æ­¢ã—, 2. ã«å…¨æŒ¯ã‚Šã—ã¦ <strong>ã‚³ãƒ”ãƒšã—ã‚„ã™ãã™ã‚‹</strong> ã“ã¨ã§è§£æ±ºã—ã¦ã„ã¾ã™
[<a href="https://github.com/kenoss/thin_delegate/blob/v0.1.0/tests/ui/pass_external_trait_def_with_uses.rs">example</a>]
.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>mod external {
</span><span>    pub struct Arg;
</span><span>
</span><span>    pub trait Hello {
</span><span>        fn hello(&amp;self, arg: Arg) -&gt; String;
</span><span>    }
</span><span>
</span><span>    impl Hello for String {
</span><span>        fn hello(&amp;self, _arg: Arg) -&gt; String {
</span><span>            format!(&quot;hello, {self}&quot;)
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span>// Each `#[thin_delegate::fill_delegate(external_trait_def = __external_trait_def)]` will be
</span><span>// expanded with uses as:
</span><span>//
</span><span>// ```
</span><span>// mod ... {
</span><span>//    use super::*;
</span><span>//
</span><span>//    use crate::external::Arg;
</span><span>//
</span><span>//    impl ...
</span><span>// }
</span><span>// ```
</span><span>//
</span><span>// It&#39;s convenient to copy&amp;paste original definition as is.
</span><span>#[thin_delegate::external_trait_def(with_uses = true)]
</span><span>mod __external_trait_def {
</span><span>    use crate::external::Arg;
</span><span>
</span><span>    #[thin_delegate::register]
</span><span>    pub trait Hello {
</span><span>        fn hello(&amp;self, arg: Arg) -&gt; String;
</span><span>    }
</span><span>}
</span><span>
</span><span>#[thin_delegate::register]
</span><span>struct Hoge(String);
</span><span>
</span><span>#[thin_delegate::fill_delegate(external_trait_def = __external_trait_def)]
</span><span>impl external::Hello for Hoge {}
</span></code></pre>
<p><code>#[thin_delegate::external_trait_def]</code> ã¯ <code>mod</code> ã«ä»˜ã‘, ãã® module ã‚’å¤–éƒ¨ crate ã® trait å®šç¾©ã‚’è²¼ã‚Šä»˜ã‘ã‚‹ãŸã‚ã®ã‚‚ã®ã¨ã—ã¦
æ‰±ã„ã¾ã™. <code>#[thin_delegate::fill_delegate]</code> å´ã§ã¯ <code>external_trait_def</code> ã«ãã® module ã® path ã‚’æŒ‡å®šã—ã¾ã™.
<code>#[thin_delegate::external_trait_def]</code> ã‚’ <code>with_uses = true</code> ä»˜ãã§ä½¿ã†ã¨ãã®ä¸­ã® <code>use</code> ã‚’
<code>#[thin_delegate::fill_delegate]</code> ã®å±•é–‹çµæœã®ä¸­ã§ã‚‚ä½¿ã‚ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ <sup class="footnote-reference"><a href="#308">8</a></sup>.</p>
<p>ã“ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã®åˆ©ç‚¹ã¯ä»¥ä¸‹ã§ã™:</p>
<ul>
<li>(ã“ã® module é…ä¸‹ã«ã¯æ™®é€šã®æ‰‹æ®µã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã—ãªã„ã¯ãšãªã®ã§,) ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã“ã® trait å®šç¾©ã§å®Ÿéš›ã«
trait ãŒå®šç¾©ã•ã‚Œã‚‹ã®ã‹ã©ã†ã‹ã«æ°—ã‚’ä½¿ã‚ãªãã¦ã‚ˆã„. (å®Ÿéš›ã¯å®šç¾©ã•ã‚Œãªã„.)</li>
<li><code>register</code>, <code>fill_delegate</code>, <code>external_trait_def</code> ãŒç›´äº¤ã—ã¦ã„ã‚‹ <sup class="footnote-reference"><a href="#309">9</a></sup> ã®ã§ã‚ã‹ã‚Šã‚„ã™ãä½¿ã„ã‚„ã™ã„.</li>
<li>crate ã‚’è·¨ãã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆãªãã¦ã‚ˆã„. ç‰¹ã« version é–“å·®ç•°.</li>
<li>è¦‡æ¨©ã‚’å–ã‚‹å¿…è¦ã‚‚èª¬å¾—ã™ã‚‹å¿…è¦ã‚‚ãªã„.</li>
</ul>
<p>ä»¥ä¸Šã§ä¸»è¦ãªæ§‹æ–‡ã¯å…¨ã¦ã§ã™. ã§ã¯å®Ÿè£…ã®è©±ã«ç§»ã‚Šã¾ã—ã‚‡ã†.</p>
<h3 id="implementation-of-thin_delegate">thin_delegate ã®å®Ÿè£…</h3>
<p>åŸºæœ¬çš„ã«ç‰©äº‹ã¨ã„ã†ã®ã¯ç­”ãˆãŒã‚ã‹ã‚Šã•ãˆã™ã‚Œã°ãã“ã«è‡³ã‚‹ã®ã¯æ¯”è¼ƒçš„ã«æ¥½ã§ã™ <sup class="footnote-reference"><a href="#310">10</a></sup>. ã‚ã¨ã¯ã‚„ã‚‹ã ã‘ã£ã¦ã‚„ã¤ã§ã™.</p>
<p>ãªã®ã§, é ‘å¼µã‚‹.</p>
<p>...ã§æ¸ˆã¾ã™ã®ã‚‚ã‚¢ãƒ¬ãªã®ã§ã‹ã„ã¤ã¾ã‚“ã§èª¬æ˜ã—ã¦ãŠãã¾ã™.</p>
<h4 id="chains-of-macros">proc macro -&gt; decl macro -&gt; proc macro</h4>
<p>2ç« ã§ enum_delegate v0.2.0, ambassador, portrait ã¯ proc macro ä¸­ã§ decl macro ã‚’ä½¿ã£ã¦æƒ…å ±ä¼é”ã—ã¦ã„ã‚‹ã“ã¨ã¯è¦‹ã¾ã—ãŸ.
thin_delegate ã¯ (enum_delegate v0.2.0, portrait ã¨åŒã˜ã) proc macro -&gt; decl macro -&gt; proc macro
ã¨å‡¦ç†ã‚’ç¹‹ã„ã§ã„ãã“ã¨ã§å®Ÿç¾ã—ã¦ã„ã¾ã™. decl macro ãƒ•ã‚§ãƒ¼ã‚ºã§ä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ã‹ã¯
<a href="https://github.com/kenoss/thin_delegate/blob/v0.0.3/src/decl_macro.rs">src/decl_macro.rs</a>
ã‚’è¦‹ã‚Œã°å…¨ã¦ã‚ã‹ã‚Šã¾ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    quote! {
</span><span>        macro_rules! #feed_trait_def_of {
</span><span>            {
</span><span>                @</span><span style="color:#d08770;">KONT </span><span>{ </span><span style="color:#bf616a;">$kont</span><span>:path },
</span><span>                $(@</span><span style="color:#bf616a;">$arg_key</span><span>:ident { </span><span style="color:#bf616a;">$arg_value</span><span>:tt },)*
</span><span>            } =&gt; {
</span><span>                </span><span style="color:#bf616a;">$kont</span><span>! {
</span><span>                    $(@</span><span style="color:#bf616a;">$arg_key </span><span>{ </span><span style="color:#bf616a;">$arg_value </span><span>},)*
</span><span>                    @</span><span style="color:#d08770;">TRAIT_DEF </span><span>{ #trait_ },
</span><span>                }
</span><span>            }
</span><span>        }
</span><span>        #[</span><span style="color:#bf616a;">allow</span><span>(unused_imports)]
</span><span>        </span><span style="color:#b48ead;">pub</span><span>(</span><span style="color:#b48ead;">crate</span><span>) </span><span style="color:#b48ead;">use </span><span>#feed_trait_def_of;
</span><span>    }
</span><span>
</span><span>...
</span><span>
</span><span>    quote! {
</span><span>        macro_rules! #feed_structenum_def_of {
</span><span>            {
</span><span>                @</span><span style="color:#d08770;">KONT </span><span>{ </span><span style="color:#bf616a;">$kont</span><span>:path },
</span><span>                $(@</span><span style="color:#bf616a;">$arg_key</span><span>:ident { </span><span style="color:#bf616a;">$arg_value</span><span>:tt },)*
</span><span>            } =&gt; {
</span><span>                </span><span style="color:#bf616a;">$kont</span><span>! {
</span><span>                    $(@</span><span style="color:#bf616a;">$arg_key </span><span>{ </span><span style="color:#bf616a;">$arg_value </span><span>},)*
</span><span>                    @</span><span style="color:#d08770;">STRUCTENUM_DEF </span><span>{ #structenum },
</span><span>                }
</span><span>            }
</span><span>        }
</span><span>        #[</span><span style="color:#bf616a;">allow</span><span>(unused_imports)]
</span><span>        </span><span style="color:#b48ead;">pub</span><span>(</span><span style="color:#b48ead;">crate</span><span>) </span><span style="color:#b48ead;">use </span><span>#feed_structenum_def_of;
</span><span>    }
</span><span>
</span><span>...
</span><span>
</span><span>    </span><span style="color:#65737e;">// Collect trait and structenum defs by CPS:
</span><span>    </span><span style="color:#65737e;">//
</span><span>    </span><span style="color:#65737e;">//    #feed_trait_def_of!
</span><span>    </span><span style="color:#65737e;">// -&gt; __thin_delegate__trampoline1!
</span><span>    </span><span style="color:#65737e;">// -&gt; #feed_structenum_def_of!
</span><span>    </span><span style="color:#65737e;">// -&gt; __thin_delegate__trampoline2!
</span><span>    </span><span style="color:#65737e;">// -&gt; #[::thin_delegate::__internal__fill_delegate]
</span><span>    quote! {
</span><span>        </span><span style="color:#96b5b4;">macro_rules! </span><span>__thin_delegate__trampoline2 {
</span><span>            {
</span><span>                @IMPL {{ </span><span style="color:#bf616a;">$impl</span><span>:item }},
</span><span>                @</span><span style="color:#d08770;">TRAIT_DEF </span><span>{ </span><span style="color:#bf616a;">$trait_def</span><span>:item },
</span><span>                @</span><span style="color:#d08770;">STRUCTENUM_DEF </span><span>{ </span><span style="color:#bf616a;">$structenum_def</span><span>:item },
</span><span>            } =&gt; {
</span><span>                #[::</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">__internal__fill_delegate</span><span>(#args)]
</span><span>                </span><span style="color:#b48ead;">mod </span><span>__thin_delegate__change_this_name {
</span><span>                    </span><span style="color:#bf616a;">$trait_def
</span><span>
</span><span>                    </span><span style="color:#bf616a;">$structenum_def
</span><span>
</span><span>                    </span><span style="color:#bf616a;">$impl
</span><span>                }
</span><span>            }
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#96b5b4;">macro_rules! </span><span>__thin_delegate__trampoline1 {
</span><span>            {
</span><span>                @IMPL {{ </span><span style="color:#bf616a;">$impl</span><span>:item }},
</span><span>                @</span><span style="color:#d08770;">TRAIT_DEF </span><span>{ </span><span style="color:#bf616a;">$trait_def</span><span>:item },
</span><span>            } =&gt; {
</span><span>                #feed_structenum_def_of! {
</span><span>                    @</span><span style="color:#d08770;">KONT </span><span>{ __thin_delegate__trampoline2 },
</span><span>                    @</span><span style="color:#d08770;">IMPL </span><span>{{ </span><span style="color:#bf616a;">$impl </span><span>}},
</span><span>                    @</span><span style="color:#d08770;">TRAIT_DEF </span><span>{ </span><span style="color:#bf616a;">$trait_def </span><span>},
</span><span>                }
</span><span>            }
</span><span>        }
</span><span>
</span><span>        #feed_trait_def_of! {
</span><span>            @</span><span style="color:#d08770;">KONT </span><span>{ __thin_delegate__trampoline1 },
</span><span>            @</span><span style="color:#d08770;">IMPL </span><span>{{ #impl_ }},
</span><span>        }
</span><span>    }
</span></code></pre>
<p>trait ã¨ struct/enum ã«å¯¾ã™ã‚‹ãµãŸã¤ã® <code>#[thin_delegate::register]</code> å‘¼ã³å‡ºã—ã§
<code>#feed_trait_def_of!</code> ã¨ <code>#feed_structenum_def_of!</code> ã‚’å®šç¾©ã—ã¾ã™.
(å®Ÿéš›ã«ã¯ã“ã‚Œã‚‰ã® macro åã¯ trait/struct/enum åä¾å­˜ã§æ±ºã¾ã‚‹.)
<code>#[thin_delegate::fill_delegate]</code> ã§ã¯æœ€åˆã« <code>#feed_trait_def_of!</code> ã‚’å‘¼ã³å‡ºã—,
CPS ã§æƒ…å ±ã‚’é›†ã‚ãŸä¸Šã§ <code>#[::thin_delegate::__internal__fill_delegate(#args)]</code>
ã‚’å‘¼ã³å‡ºã—ã¾ã™.</p>
<p>ã“ã‚Œ, ã“ã®ã©ã‚“ã©ã‚“ macro å±•é–‹ã‚’ç¹‹ã’ã¦ã„ã£ã¦å‡¦ç†ã‚’ã™ã‚‹å½¢å¼, ã©ã“ã‹ã§è¦‹ãŸã“ã¨ã‚ã‚‹äººã‚‚å¤šã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“.
åƒ•ã¯ã€ŒTeX ã ãªã€œã€ã¨æ€ã„ã¾ã—ãŸ <sup class="footnote-reference"><a href="#311">11</a></sup>.</p>
<p>ã“ã®å½¢å¼ã«ã‚ˆã£ã¦ unit test ã‚‚ç°¡å˜ã«ãªã£ã¦ã„ã¾ã™. <a href="https://kenoss.github.io/blog/2025-01-04-thin_delegate-3/#test">test</a> ã§è¦‹ã¾ã™.</p>
<h4 id="generics-tairt-bound">generics/trait bound</h4>
<p>thin_delegate ã¯ generics/trait bound ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ <sup class="footnote-reference"><a href="#312">12</a></sup>.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>]
</span><span style="color:#b48ead;">pub trait </span><span>Hello&lt;T, const N: usize&gt; {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">hello</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; [T; N];
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Hello&lt;</span><span style="color:#b48ead;">u8</span><span>, 4&gt; </span><span style="color:#b48ead;">for </span><span>char {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">hello</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; [</span><span style="color:#b48ead;">u8</span><span>; </span><span style="color:#d08770;">4</span><span>] {
</span><span>        </span><span style="color:#b48ead;">let mut</span><span> buf = [</span><span style="color:#d08770;">0</span><span>; </span><span style="color:#d08770;">4</span><span>];
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">encode_utf8</span><span>(&amp;</span><span style="color:#b48ead;">mut</span><span> buf);
</span><span>        buf
</span><span>    }
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>]
</span><span style="color:#b48ead;">struct </span><span>Hoge(</span><span style="color:#b48ead;">char</span><span>);
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">fill_delegate</span><span>]
</span><span style="color:#b48ead;">impl </span><span>Hello&lt;</span><span style="color:#b48ead;">u8</span><span>, 4&gt; </span><span style="color:#b48ead;">for </span><span>Hoge {}
</span></code></pre>
<p>ã“ã“ã§å•é¡Œã¨ãªã‚‹ã®ã¯ trait å®šç¾©ã® signature <code>fn hello(&amp;self) -&gt; [T; N];</code> ã¨ <code>impl Hello&lt;u8, 4&gt; for Hoge {}</code> ã‹ã‚‰
<code>fn hello(&amp;self) -&gt; [u8; 4]</code> ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™.</p>
<p>ã“ã®å‡¦ç†ã¯ <a href="https://github.com/kenoss/thin_delegate/blob/v0.0.3/src/generic_param_replacer.rs">src/generics_param_replacer.rs</a>
ã«ã‚ã‚Šã¾ã™. visitor ã‚’ä½¿ã£ã¦ç½®ãæ›ãˆã¦ã„ãã ã‘ã§ã™ <sup class="footnote-reference"><a href="#313">13</a></sup>.
(ä¸Šã®ä¾‹ã ã¨ <code>{T =&gt; u8}</code>, <code>{N =&gt; 4}</code> ã¨ã„ã† <code>HashMap</code> ã‚’ä½¿ã£ã¦ç™ºè¦‹æ¬¡ç¬¬ä»£å…¥ã—ã¦ã„ã.)</p>
<p>ã“ã‚Œã‚‚ã¾ãŸ <code>impl</code> ã«ä»˜ã‘ã‚‹ã¨ã„ã†æ§‹æ–‡ã‚’æ¡ç”¨ã—ãŸåˆ©ç‚¹ã®ã²ã¨ã¤ã§ã™ <sup class="footnote-reference"><a href="#304">4</a></sup>.</p>
<p>ã¡ãªã¿ã« super trait ã¯ç‰¹ã«æ„è­˜ã™ã‚‹å¿…è¦ã‚ã‚Šã¾ã›ã‚“.
<a href="https://github.com/kenoss/sabiniwm/blob/ed5d2c9cc199dd3358b33e8ef700e31fc39ea6ed/crates/sabiniwm/src/backend/mod.rs#L34-L55"><code>impl</code> ã‚’è¤‡æ•°æ›¸ã„ã¦ã‚‚ã‚‰ã†ã ã‘</a>
ã§ã™.</p>
<h4 id="macro-hygiene">macro hygiene</h4>
<p>ãŠãã‚‰ãæœ€çµ‚æ®µã« attribute macro ã‚’ä½¿ã£ãŸå½±éŸ¿ã ã¨æ€ã†ã®ã§ã™ãŒ, macro hygiene ãŒå•é¡Œã«ãªã‚Šã¾ã—ãŸ <sup class="footnote-reference"><a href="#314">14</a></sup>.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    quote! {
</span><span>        </span><span style="color:#96b5b4;">macro_rules! </span><span>__thin_delegate__trampoline2 {
</span><span>            {
</span><span>                @IMPL {{ </span><span style="color:#bf616a;">$impl</span><span>:item }},
</span><span>                @</span><span style="color:#d08770;">TRAIT_DEF </span><span>{ </span><span style="color:#bf616a;">$trait_def</span><span>:item },
</span><span>                @</span><span style="color:#d08770;">STRUCTENUM_DEF </span><span>{ </span><span style="color:#bf616a;">$structenum_def</span><span>:item },
</span><span>            } =&gt; {
</span><span>                #[::</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">__internal__fill_delegate</span><span>(#args)]
</span><span>                </span><span style="color:#b48ead;">mod </span><span>__thin_delegate__change_this_name {
</span><span>                    </span><span style="color:#bf616a;">$trait_def
</span><span>
</span><span>                    </span><span style="color:#bf616a;">$structenum_def
</span><span>
</span><span>                    </span><span style="color:#bf616a;">$impl
</span><span>                }
</span><span>            }
</span><span>        }
</span><span>...
</span></code></pre>
<p><code>$trait_def</code> (ã‚„ <code>$impl</code>) ã®ã¨ã“ã‚ã«ã¯ trait method ãŒå«ã¾ã‚Œã¾ã™ãŒ, ãã“ã«ã¯ <code>self</code> ã¨ã„ã†ãƒˆãƒ¼ã‚¯ãƒ³ãŒå«ã¾ã‚Œå¾—ã¾ã™.
(e.g. <code>fn hello(&amp;self) -&gt; [T; N];</code>) ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³åˆ—ã¯ <code>#feed_trait_def_of!</code> ã‹ã‚‰æ¥ã¦ã„ã‚‹ã®ã§,
decl macro ã® (partial) hygiene ã«ã‚ˆã£ã¦ã“ã® <code>self</code> ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“
[<a href="https://veykril.github.io/tlborm/syntax-extensions/hygiene.html">1</a>]
[<a href="https://veykril.github.io/tlborm/decl-macros/minutiae/hygiene.html">2</a>].
ãƒˆãƒ¼ã‚¯ãƒ³ãŒã©ã“ã«ç”±æ¥ã™ã‚‹ã‹ã¨ã„ã†æƒ…å ±ã¯ <code>Span</code> ã«å…¥ã£ã¦ã„ã‚‹ã®ã§
[<a href="https://veykril.github.io/tlborm/proc-macros/hygiene.html">3</a>],
å…¨ã¦ã® sigunature ã® <code>self</code> ã‚’ç½®ãæ›ãˆã¦ proc macro ç”±æ¥ã¨ã™ã‚‹
[<a href="https://github.com/kenoss/thin_delegate/blob/v0.0.3/src/self_replacer.rs">src/self_replacer.rs</a>]
ã“ã¨ã§ã“ã®å•é¡Œã‚’è§£æ±ºã—ã¦ã„ã¾ã™ <sup class="footnote-reference"><a href="#315">15</a></sup>.</p>
<h4 id="attr-macro-external_trait_def">Attribute macro <code>external_trait_def</code></h4>
<p><code>#[thin_delegate::external_trait_def]</code> ã¨ <code>#[thin_delegate::register]</code> ã¯ç›´äº¤ã—ã¦ã„ã¾ã—ãŸ.
ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«, å†…éƒ¨çš„ã«ã¯ <code>#[thin_delegate::external_trait_def]</code> å‘¼ã³å‡ºã—ã§ãã®é…ä¸‹ã«ã‚ã‚‹ã‚‚ã®ã«
<code>#[::thin_delegate::__internal__is_external_marker]</code> attribute ã‚’ä»˜ã‘ã¦å›ã‚Š,
<code>#[thin_delegate::register]</code> ã®å‘¼ã³å‡ºã—æ™‚ã«ãã®æœ‰ç„¡ã§æŒ™å‹•ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™.</p>
<p>å®Ÿè£…ã«ãŠã‘ã‚‹å¤§ãã‚ã®è¦‹æ‰€ã¯ã“ã‚Œã§çµ‚ã‚ã‚Šã§ã™.</p>
<h3 id="other-techniques">ãã®ä»–ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</h3>
<h4 id="test">test</h4>
<p>å€‹äººçš„ã« <strong>ãƒ†ã‚¹ãƒˆã¯ãã®æŒ™å‹•ãŒãƒã‚§ãƒƒã‚¯ã§ãã‚‹æœ€å†…ã«æ›¸ãã¹ã</strong> ã¨æ€ã£ã¦ã„ã¾ã™. (ã“ã®ã¸ã‚“ã¯åˆ¥è¨˜äº‹ã§æ›¸ã‘ã‚‹ã¨ã‚ˆã„ã§ã™ã­.)</p>
<p>å…·ä½“ä¾‹ã¨ã—ã¦, thin_delegate ã§ã¯ unit test ã¨ trybuild ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆã‚’è¡Œã£ã¦ã„ã¾ã™.</p>
<ul>
<li>unit test: macro ã®å±•é–‹å½¢ã®ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹.</li>
<li>trybuild: å®Ÿéš›ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚‹ã‹, ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼,
<code>#[thin_delegate::__internal__fill_delegate]</code> ã«è‡³ã‚‹ã¾ã§ã®éƒ¨åˆ†ãªã©ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹.</li>
</ul>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    quote! {
</span><span>        </span><span style="color:#96b5b4;">macro_rules! </span><span>__thin_delegate__trampoline2 {
</span><span>            {
</span><span>                @IMPL {{ </span><span style="color:#bf616a;">$impl</span><span>:item }},
</span><span>                @</span><span style="color:#d08770;">TRAIT_DEF </span><span>{ </span><span style="color:#bf616a;">$trait_def</span><span>:item },
</span><span>                @</span><span style="color:#d08770;">STRUCTENUM_DEF </span><span>{ </span><span style="color:#bf616a;">$structenum_def</span><span>:item },
</span><span>            } =&gt; {
</span><span>                #[::</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">__internal__fill_delegate</span><span>(#args)]
</span><span>                </span><span style="color:#b48ead;">mod </span><span>__thin_delegate__change_this_name {
</span><span>                    </span><span style="color:#bf616a;">$trait_def
</span><span>
</span><span>                    </span><span style="color:#bf616a;">$structenum_def
</span><span>
</span><span>                    </span><span style="color:#bf616a;">$impl
</span><span>                }
</span><span>            }
</span><span>        }
</span><span>...
</span></code></pre>
<p>æœ€çµ‚æ®µã¯ <code>#[thin_delegate::__internal__fill_delegate]</code> ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã®ã§ã—ãŸ.
ã¨ã„ã†ã“ã¨ã¯ã“ã® attribute macro ã®å…¥å‡ºåŠ›ã‚’ unit test ã™ã‚Œã°ã©ã†å±•é–‹ã•ã‚Œã‚‹ã®ã‹ã®ãƒã‚§ãƒƒã‚¯ãŒå¯èƒ½ã§ã™.</p>
<p>ä¸€æ–¹, å®Ÿéš›ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚‹ã‹ãªã©ã¯ã“ã® unit test ã§ã¯ãƒã‚§ãƒƒã‚¯ã§ãã¾ã›ã‚“. (e.g. macro hygiene of <code>self</code>)
ãªã®ã§ã“ã“ã¯ trybuild ã§ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™. é€†ã« trybuild ã§ã¯å±•é–‹å½¢ã®ãƒã‚§ãƒƒã‚¯ã¯ã§ãã¾ã›ã‚“.</p>
<p>ã‚¨ãƒ©ãƒ¼ã¯åŸ·æ‹—ã«ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹ã“ã¨ã§ã®ã¿æ”¹å–„ã§ãã¾ã™. ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã‚“ã .
<a href="https://qiita.com/legokichi/items/4e85ec1e74f4e754fb94#ci-%E3%81%A7-cargo-clippy---tests---examples-----dclippyall-%E3%81%97%E3%82%8D">ãƒ‘ãƒ©ãƒã‚¤ã‚¢ã«ãªã‚Œ</a>
<sup class="footnote-reference"><a href="#316">16</a></sup></p>
<h4 id="trivial-coding">trivial coding</h4>
<p>å€‹äººçš„ã« <strong>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã® 97% ã¯ trivial ã§ã‚ã‚‹ã¹ã</strong> ã¨æ€ã£ã¦ã„ã¾ã™. (ã“ã‚Œã‚‚ã¯åˆ¥è¨˜äº‹ry)</p>
<p>äººé–“ã®è„³ãŒæœ€ã‚‚è²´é‡ãªãƒªã‚½ãƒ¼ã‚¹ã . ãã‚Œã‚’ç„¡é§„ã«ã™ã‚‹ã®ã¯å¯èƒ½ãªé™ã‚Šé¿ã‘ãªã‘ã‚Œã°ã„ã‘ãªã„.
ä½•ã‚ˆã‚Šåƒ•ãŒèª­ã‚ãªã„.</p>
<p>ã¨ã„ã†ã‚ã‘ã§å…¨ç·¨ã«ãŠã„ã¦åƒ•ãŒèª­ã‚ã‚‹æ§˜ã«æ›¸ã„ã¦ã„ã¾ã™ <sup class="footnote-reference"><a href="#317">17</a></sup>.
ä¸€ä¾‹ã§ã—ã‹ãªã„ã‘ã©,
<a href="https://github.com/SOF3/portrait/blob/master/codegen/src/derive.rs#L62-L113"><code>portrait::delegate</code> ã®å¼•æ•°ã® parse</a>
ã¨
<code>thin_delegate::fill_delegate</code> ã®å¼•æ•°ã® parse
[<a href="https://github.com/kenoss/thin_delegate/blob/v0.0.3/src/fill_delegate_args.rs#L149-L186">1</a>]
[<a href="https://github.com/kenoss/thin_delegate/blob/v0.0.3/src/fill_delegate_args.rs#L125-L147">2</a>]
ã‚’æ¯”è¼ƒã—ã¦ã¿ã‚‹ã¨ã‚ˆã„ã‹ã‚‚ã—ã‚Œãªã„ <sup class="footnote-reference"><a href="#318">18</a></sup>.</p>
<p>ã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹ã®ã‚‚è‡ªæ˜ã«ã™ã‚‹ãŸã‚ã®æ´»å‹•ã®ã²ã¨ã¤ã§ã™.</p>
<h3 id="summary">3ç« ã¾ã¨ã‚</h3>
<p>ã“ã®ç« ã§ã¯ thin_delegate ã®è¨­è¨ˆã¨å®Ÿè£…ã‚’èª¬æ˜ã—ã¾ã—ãŸ.
<a href="../2025-01-05-thin_delegate-4">4ç« </a> ã§ã¯ã¾ã¨ã‚ã‚’è¡Œãªã„ã¾ã™.</p>
<div class="footnote-definition" id="301"><sup class="footnote-definition-label">1</sup>
<p>åŒ…ä¸ã«ã¯ã€Œã‚ˆãåˆ‡ã‚Œã¾ã™ã€ã€Œå±é™ºãªã®ã§å–ã‚Šæ‰±ã„æ³¨æ„ã€ã€Œäººã«å‘ã‘ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€ãªã©ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã§ã—ã‚‡ã†.</p>
</div>
<div class="footnote-definition" id="302"><sup class="footnote-definition-label">2</sup>
<p>ä½•æ•…ã‹? ã“ã‚Œã¯æ¨æ¸¬ã§ã—ã‹ã‚ã‚Šã¾ã›ã‚“ãŒ, è€ƒãˆã‚‰ã‚Œã‚‹ã®ã¯ 1. derive macro <code>#[derive(ambassador::Delegate)]</code>
ã‚’ struct/enum ã«ä»˜ã‘ã‚‹ã“ã¨ã«å›ºåŸ·ã—ãŸ. 2. 2ç« ã§è§£èª¬ã—ãŸæ§˜ã« <code>#[derive(ambassador::Delegate)]</code>
ã¯å†…éƒ¨ã§ decl macro ã®ã¿ã§ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãŠã‚Š, thin_delegate ã®æ§˜ã« proc macro ã‚’ä½¿ã£ãŸã‚Š decl macro
ã‚’å¤šæ®µã«ã™ã‚‹ã®ã‚’å«Œã£ãŸ, ã‚ãŸã‚Šã§ã—ã‚‡ã†ã‹. (çŸ¥ã‚‰ã‚“ã‘ã©)</p>
</div>
<div class="footnote-definition" id="303"><sup class="footnote-definition-label">3</sup>
<p>å®Ÿã¯ãã‚Œä»¥ä¸Šã«, trait <code>Trait</code> ãŒå®Ÿåœ¨ã—ãªã„ã®ã« <code>#[derive(Trait)]</code> ã¨æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã¯æ…é‡ã«ãªã‚‹ã¹ãã¨
åƒ•ã¯æ€ã£ã¦ã„ã¾ã™. <code>derive_more::From</code>, <code>derive_builder::Builder</code>, <code>thiserror::Erorr</code>
ãã‚‰ã„ã¾ã§ãªã‚‰è¨±å®¹ã‹ãª. <code>ambassador::Delegate</code> ã‚„ <code>auto_delegate::Delegate</code> ã¯ã‚„ã‚Šã™ãã ã¨æ€ã„ã¾ã™.
<code>thiserror::Erorr</code> ãŒè¨±ã›ã¦ã“ã‚Œã‚‰ãŒè¨±ã›ãªã„ã®ã¯ãªã‚“ã§ã ã‚ã†...?</p>
</div>
<div class="footnote-definition" id="304"><sup class="footnote-definition-label">4</sup>
<p>ã€Œä¸€ç®‡æ‰€ç›´ã›ã°å…¨ã¦ãŒç›´ã‚‹ã€</p>
</div>
<div class="footnote-definition" id="305"><sup class="footnote-definition-label">5</sup>
<p>ç„¡ç†ã‚„ã‚Šã‚„ã‚ã†ã¨ã™ã‚‹ã¨ ambiguity ãŒå‡ºã¦ãã¦ã—ã¾ã„ã¾ã™
[<a href="https://github.com/kenoss/kenoss.github.io/content/blog/2025-01-01-thin_delegate_aux/tests/ui/portrait/pass_limitation_default_impl_ambiguity.rs">example</a>].</p>
</div>
<div class="footnote-definition" id="306"><sup class="footnote-definition-label">6</sup>
<p>å®Ÿã¯è¨­è¨ˆæ®µéšã§ portrait ã‚’å‚è€ƒã«ã—ãŸã‚ã‘ã§ã¯ãªã <code>impl</code> ã«ä»˜ã‘ã‚‹ã®ã¨ <code>delegate</code> crate ä¸¦ã®æŸ”è»Ÿæ€§ã‚’æŒãŸã›ã‚ˆã†ã¨ã—ãŸã‚‰
å†ç™ºè¦‹ã—ãŸã¨ã„ã†ã‚„ã¤ãªã®ã§ã™ãŒ, èª¬æ˜ãŒæ¥½ãªã®ã§ãã†ã„ã†ã“ã¨ã«ã—ã¦ãã ã•ã„.</p>
</div>
<div class="footnote-definition" id="307"><sup class="footnote-definition-label">7</sup>
<p>æµçŸ³ã«ã“ã‚Œã¯ã¡ã‚ƒã‚“ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚Œã°ã„ã„ã®ã§ã¯? ã¯ã„...</p>
</div>
<div class="footnote-definition" id="308"><sup class="footnote-definition-label">8</sup>
<p>ã„ã¡ã‚ƒã‚‚ã‚“ã¤ã‘ãƒã‚¤ãƒ³ãƒˆ. ã“ã®æŒ™å‹•ã¯ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå±•é–‹ç³»ã‚’æƒ³åƒã§ãã‚‹ãã‚‰ã„ã‚·ãƒ³ãƒ—ãƒ«ã€ã§ã—ã‚‡ã†ã‹?
ã„ã‚„ã§ã‚‚ã“ã‚Œãªã„ã¨é¢å€’ãªã‚“ã ã‚ˆã‰ã€œã€œã€œ
[<a href="https://github.com/kenoss/sabiniwm/commit/41c0222">sabiniwm 41c0222</a>]</p>
</div>
<div class="footnote-definition" id="309"><sup class="footnote-definition-label">9</sup>
<p>(è¨±å®¹ã§ãã‚‹è¿½åŠ ã‚³ã‚¹ãƒˆã§) ç›´äº¤ã«ã§ãã‚‹ã¨ãã¯ç›´äº¤ã«ã—ãŸæ–¹ãŒè‰¯ã„. å¤äº‹è¨˜ã«ã‚‚ãã†æ›¸ã„ã¦ã‚ã‚‹.</p>
</div>
<div class="footnote-definition" id="310"><sup class="footnote-definition-label">10</sup>
<p>æ•°å­¦ã¨ã‹ NP ã¨ã‹.</p>
</div>
<div class="footnote-definition" id="311"><sup class="footnote-definition-label">11</sup>
<p>TeX ã«ã¯ãƒ¬ã‚¸ã‚¹ã‚¿ã‚‚ã‚ã‚Šã¾ã™ãŒ, (å…ˆé ­) å®Œå…¨å±•é–‹å¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒé‡è¦ãªã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™.
ãã†ã„ã†ã‚±ãƒ¼ã‚¹ã§ã¯ã“ã®æ§˜ã« CPS ã§å‡¦ç†ã™ã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™.
[<a href="https://zrbabbler.hatenablog.com/entry/20130526/1369591778">1</a>]
[<a href="https://zrbabbler.hatenablog.com/entry/20120128/1327735636">2</a>]
[<a href="https://zrbabbler.hatenablog.com/entry/20150606/1433549572">3</a>]
[<a href="https://blog.wtsnjp.com/2018/04/28/expl3-for-tex-users/">4</a>]
(TeX è©³ã—ããªã„ã‹ã‚‰ã—ã‚‰ã‚“ã‘ã©)</p>
</div>
<div class="footnote-definition" id="312"><sup class="footnote-definition-label">12</sup>
<p>å…¨éƒ¨ã‚µãƒãƒ¼ãƒˆã§ãã¦ã„ã‚‹ã¨æ€ã†ã®ã§ã™ãŒ, ç©´ã‚’è¦‹ã¤ã‘ãŸæ–¹ã¯ issue ã§æ•™ãˆã¦ãã ã•ã„.</p>
</div>
<div class="footnote-definition" id="313"><sup class="footnote-definition-label">13</sup>
<p>æœ€çµ‚æ®µã« proc macro ã‚’ä½¿ã£ã¦ã„ãªã„ ambassador ã‚„ <code>impl</code> ã«ä»˜ã‘ãªã„ enum_delegate ã¯ã¨ã‚‚ã‹ã,
å‡¦ç†æ–¹æ³•ã‚‚æ§‹æ–‡ã‚‚ä¼¼ã¦ã„ã‚‹ portrait ãŒä½•æ•…ã“ã‚Œã‚’ã‚„ã£ã¦ã„ãªã„ã®ã‹ã¯è¬ã§ã™.</p>
</div>
<div class="footnote-definition" id="314"><sup class="footnote-definition-label">14</sup>
<p>ã‚ã‚Šã¨ãƒ‡ãƒãƒƒã‚°ãŒé¢å€’ã ã£ãŸè¦šãˆãŒã‚ã‚Šã¾ã™. unit test ã§ã‚‚ <code>cargo expand</code> ã§ã‚‚å•é¡Œãªã„æ§˜ã«è¦‹ãˆã‚‹ã®ã§.</p>
</div>
<div class="footnote-definition" id="315"><sup class="footnote-definition-label">15</sup>
<p>ã“ã†ã‚„ã£ã¦ hygiene ã‚’å›é¿ã™ã‚‹ã®ã¯, ã¾ãã“ã®ã‚±ãƒ¼ã‚¹ãªã‚‰å•é¡Œãªã„ã§ã—ã‚‡ã†.</p>
</div>
<div class="footnote-definition" id="316"><sup class="footnote-definition-label">16</sup>
<p>ã¾ãã—ã‹ã—å…¨ã¦ã®åˆ†å²ã«å¯¾ã—ã¦ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ãŸã‚Šã™ã‚‹ã®ã¯ç¾å®Ÿçš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“.
ä»£è¡¨çš„ãªã‚‚ã®ã ã‘ãƒ†ã‚¹ãƒˆã™ã‚‹ãªã©ã§ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™.
ç©´ãŒã‚ã£ã¦ã‚‚ OSS ãªã®ã§æ–‡å¥ãŒã‚ã‚‹äººãŒ issue/PR ã§æ•™ãˆã¦ãã‚Œã‚‹ã§ã—ã‚‡ã†.</p>
</div>
<div class="footnote-definition" id="317"><sup class="footnote-definition-label">17</sup>
<p>ã€Œè‡ªåˆ†ãŒèª­ã‚ã‚‹ã‹ã€ã¨ã€Œtrivial ã‹ã€ã¨ã„ã†ã®ã«ã¯å¤©ã¨åœ°ã»ã©ã®å·®ãŒã‚ã‚‹ã‚ã‘ã§ã™ãŒ,
ã—ã‹ã—ä»–ã«è‡ªåˆ†ã§å®Œçµã™ã‚‹åˆ¤å®šæ–¹æ³•ãŒãªã„...</p>
</div>
<div class="footnote-definition" id="318"><sup class="footnote-definition-label">18</sup>
<p>ã“ã® <code>eq_token</code> ãªã©ã¾ã§ parse ã™ã‚‹ã®ã¯ <code>syn</code> ã‚’çœŸä¼¼ã¦ã„ã‚‹.
ã“ã®ç„¡é§„ã‚’æ¶ˆã™ã®ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’èª­ã¿ã‚„ã™ãä¿ã¤ã®ã¨ã©ã¡ã‚‰ãŒå¤§åˆ‡ã‹?
ã“ã® proc macro ã®å±•é–‹ãªã‚“ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ä¸­ã§æ•°å›ã—ã‹èµ·ããªã„ã®ã .</p>
</div>

    </div>
</article>

            </main>
            <footer>
                <div class="footer">
                    <small class="footer-left">
                        Â© 2021--2024. All rights reserved.
                    </small>
                    <small class="footer-right">
                        Powered by <a href="https://www.getzola.org">Zola</a>
                    </small>
                </div>
            </footer>
        </div>
    </body>
</html>
