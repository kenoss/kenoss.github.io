<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>
crate thin_delegate ã‚’æ›¸ã„ãŸ (2&#x2F;4) | å†·ãŸãæ²¢ã®å²©é™°ã®
</title>

        
<meta property="og:image" content="https:&#x2F;&#x2F;kenoss.github.io&#x2F;ogp.jpg" />
<meta property="og:title" content="crate thin_delegate ã‚’æ›¸ã„ãŸ (2&#x2F;4)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https:&#x2F;&#x2F;kenoss.github.io&#x2F;blog&#x2F;2025-01-03-thin_delegate-2&#x2F;" />

<meta property="og:site_name" content="å†·ãŸãæ²¢ã®å²©é™°ã®" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@keno_ss" />


        



        <link rel="stylesheet" href="https://kenoss.github.io/theme.css">
    </head>
    <body>
        <div class="content">
            <header>
                <div class="header-left">
                    <a href="https:&#x2F;&#x2F;kenoss.github.io" class="header-logo">å†·ãŸãæ²¢ã®å²©é™°ã®</a>
                </div>
                <div class="header-right">
                </div>
            </header>
            <main>
                
<article itemscope itemtype="http://schema.org/BlogPosting">
    <div class="headline" itemprop="headline">
        <h1 class="post-title">crate thin_delegate ã‚’æ›¸ã„ãŸ (2&#x2F;4)</h2>
        <div class="border"></div>
        <div>
            <time datetime="2025-01-03" class="post-date" itemprop="datePublished">
                2025-01-03
            </time>
            
                |
                
                    <span class="post-tag">ğŸ¦€ rust</span>
                
                    <span class="post-tag">ğŸ¦€ tech</span>
                
                    <span class="post-tag">ğŸ¦€ thin_delegate</span>
                
                        
        </div>
    </div>
    <div itemprop="articleBody">
        <ul>
<li><a href="../2025-01-02-thin_delegate-1">1ç« : <code>thin_delegate</code> ã®ç´¹ä»‹</a></li>
<li><a href="../2025-01-03-thin_delegate-2">2ç« : proc macro é–“ã§ã®æƒ…å ±ä¼é”ã¨ delegation crate æ¯”è¼ƒ</a>
<ul>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#problem-definition-share-data-between-proc-macro">å•é¡Œ: proc macro é–“ã§ã®æƒ…å ±ä¼é”</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#enum-dispatch"><code>enum_dispatch</code></a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/#local-state-for-proc-macro">é–‘è©±ä¼‘é¡Œ: proc macro ã§éæ¿€ãªã“ã¨ã‚’ã‚„ã‚ŠãŸã„</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#enum-delegate-v0.2.0"><code>enum_delegate</code> v0.2.0</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#auto-delegate"><code>auto-delegate</code></a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#enum-delegate-v0.3.0"><code>enum_delegate</code> v0.3.0</a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#ambassador"><code>ambassador</code></a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#portrait"><code>portrait</code></a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#delegate"><code>delegate</code></a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#delegate-attr"><code>delegate-attr</code></a></li>
<li><a href="https://kenoss.github.io/blog/2025-01-03-thin_delegate-2/./#summary">2ç« ã¾ã¨ã‚</a></li>
</ul>
</li>
<li><a href="../2025-01-04-thin_delegate-3">3ç« : <code>thin_delegate</code> ã®è¨­è¨ˆã¨å®Ÿè£…</a></li>
<li><a href="../2025-01-05-thin_delegate-4">4ç« : ã¾ã¨ã‚</a></li>
</ul>
<h2 id="2zhang-proc-macro-jian-denoqing-bao-chuan-da-to-delegation-crate-bi-jiao">2ç« : proc macro é–“ã§ã®æƒ…å ±ä¼é”ã¨ delegation crate æ¯”è¼ƒ</h2>
<p>1ç« ã§ã¯åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’è¦‹ã¾ã—ãŸ.
ã“ã®ç« ã§ã¯ã„ãã¤ã‹ã®æŠ€è¡“çš„ãªèª²é¡Œã®ã†ã¡, æœ€ã‚‚é‡è¦ãª <strong>proc macro é–“ã§ã®æƒ…å ±ä¼é”æ–¹æ³•</strong> ã‚’æ‰±ã„ã¾ã™.
ã¾ãŸãã‚Œã«ä¼´ã„, <strong>æ—¢å­˜ã® delegation ç³» crate ã®æ¯”è¼ƒ</strong> ã‚‚è¡Œã„ã¾ã™.</p>
<p>æ§‹æ–‡çš„ãªè‰¯ã—æ‚ªã—ã¯ã“ã®ç« ã§ã¯åˆ¤æ–­ã—ã¾ã›ã‚“. 3ç« ã§ã¾ã¨ã‚ã¦æ‰±ã„ã¾ã™.</p>
<h3 id="problem-definition-share-data-between-proc-macro">å•é¡Œ: proc macro é–“ã§ã®æƒ…å ±ä¼é”</h3>
<p>thin_delegate ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯ä»¥ä¸‹ã®æ§˜ãªã‚‚ã®ã§ã—ãŸ.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>] </span><span style="color:#65737e;">// (1-2)
</span><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>] </span><span style="color:#65737e;">// (1-3)
</span><span style="color:#b48ead;">struct </span><span>Window {
</span><span>    </span><span style="color:#bf616a;">rect</span><span>: Rect,
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">thin_delegate</span><span>::</span><span style="color:#bf616a;">fill_delegate</span><span>]
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Window {} </span><span style="color:#65737e;">// (1-4)
</span></code></pre>
<p>(1-2) ã§ trait <code>ScoledShape</code>, (1-3) ã§ struct <code>Window</code> ã®æƒ…å ±ã‚’è¦šãˆ, (1-4) ã§ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’åˆ©ç”¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è‡ªå‹•å®Ÿè£…ã—ã¦ã„ã¾ã™.
ã¤ã¾ã‚Š, <strong>è¤‡æ•°ã® proc macro é–“ã§ trait ã‚„å‹ã«ç´ä»˜ãæƒ…å ±ã‚’ä¼é”</strong>ã—ã¦ã„ã¾ã™.
ã¾ãŸ, ã“ã®å•é¡Œã¯ <strong>å¤–éƒ¨ crate ã® trait ã®æ‰±ã„</strong> ã‚‚è¦ç´ ã¨ã—ã¦çµ¡ã‚“ã§ãã¾ã™.</p>
<p>ã•ã¦, ã“ã‚Œã¯ã©ã†ã‚„ã‚‹ã®ã§ã—ã‚‡ã†ã‹?</p>
<p>ã“ã®å•é¡Œã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ–¹æ³•ã¯ crate æ¯ã«ç•°ãªã‚Šã¾ã™. ãªã®ã§æ—¢å­˜ã®å…·ä½“çš„ãª crate ã‚’æŒ™ã’, ãã‚Œã®å®Ÿè£…æ–¹é‡ã‚’è¦‹ã‚‹ã“ã¨ã«ã—ã¾ã—ã‚‡ã†.</p>
<h3 id="enum-dispatch"><code>enum_dispatch</code></h3>
<ul>
<li><a href="https://crates.io/crates/enum_dispatch">crates.io</a></li>
<li><a href="https://gitlab.com/antonok/enum_dispatch">repository</a></li>
<li><a href="https://docs.rs/enum_dispatch/latest/enum_dispatch">doc</a></li>
<li>Initial commit: 2018/12</li>
</ul>
<p>enum_dispatch ã¯ (åƒ•ãŒçŸ¥ã‚‹é™ã‚Š) trait method ã®è‡ªå‹• delegation ã‚’æ‰±ã£ãŸæœ€å¤ã® crate ã§ã™.
crates.io ã§ daily (?) ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰35kè¶Šãˆã§, Twitter ã§ã‚‚åº¦ã€…ç›®ã«ã—ã¾ã™. è‡ªåˆ†ã‚‚ã“ã‚Œã‚’æœ€åˆã«æ‰‹ã«å–ã‚Šã¾ã—ãŸ.</p>
<p>enum_dispatch ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯ä»¥ä¸‹ã§ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">enum_dispatch</span><span>::</span><span style="color:#bf616a;">enum_dispatch</span><span>] </span><span style="color:#65737e;">// (2-1)
</span><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">enum_dispatch</span><span>::</span><span style="color:#bf616a;">enum_dispatch</span><span>(ShapeI)] </span><span style="color:#65737e;">// (2-2)
</span><span style="color:#b48ead;">enum </span><span>Shape {
</span><span>    Rect(Rect),
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let</span><span> rect = Rect { width: </span><span style="color:#d08770;">2.0</span><span>, height: </span><span style="color:#d08770;">3.0 </span><span>};
</span><span>    assert_eq!(rect.</span><span style="color:#96b5b4;">area</span><span>(), </span><span style="color:#d08770;">6.0</span><span>);
</span><span>    </span><span style="color:#b48ead;">let</span><span> shape = Shape::Rect(rect);
</span><span>    assert_eq!(shape.</span><span style="color:#96b5b4;">area</span><span>(), </span><span style="color:#d08770;">6.0</span><span>);
</span><span>}
</span></code></pre>
<p>(2-1) ã§ trait å®šç¾©ã®æƒ…å ±ã‚’ç™»éŒ²ã—, (2-2) ã§ enum å®šç¾©ã¨è‡ªå‹• delegation ã‚’åŒæ™‚ã«è¡Œã£ã¦ã„ã¾ã™.
thin_delegate ã®æ§˜ã« <code>impl</code> ã¯ä¸è¦ã§ã™. ã¾ãŸ, trait ã¨ enum ã®é †ç•ªã‚’å¤‰ãˆã‚‹ã“ã¨ã‚‚ã§ãã¾ã™.</p>
<p>ã“ã®æƒ…å ±ä¼é”ã¯
<strong>proc macro crate ä¸­ã® global variables ã«æ–‡å­—åˆ—åŒ–ã—ãŸ trait/enum ã®å®šç¾©ã‚’ä¿å­˜ã™ã‚‹</strong>
ã“ã¨ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã¾ã™. ã‚ˆã‚Šè©³ç´°ã«ã¯ <sup class="footnote-reference"><a href="#201">1</a></sup>:</p>
<ol>
<li>(2-1) ã® trait <code>ShapeI</code> ã«å¯¾ã™ã‚‹ <code>enum_dispatch::enum_dispatch</code> å‘¼ã³å‡ºã—ã«ãŠã„ã¦,
trait <code>ShapeI</code> ã® token stream ã‚’æ–‡å­—åˆ—åŒ–ã—ãŸã‚‚ã®ã‚’ <code>HashMap</code> <code>TRAIT_DEFS</code> ã«ä¿å­˜ã™ã‚‹
[<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/lib.rs?ref_type=tags#L378">code</a>]
[<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/cache.rs?ref_type=tags#L38-39"><code>TRAIT_DEFS</code></a>].
ã“ã®ã¨ã generics ã®æƒ…å ±ã‚‚ä¸€éƒ¨ <code>HashMap</code> ã®ã‚­ãƒ¼ã¨ã—ã¦å«ã‚ã‚‹
[<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/cache.rs?ref_type=tags#L49-50">code</a>].</li>
<li>(2-2) ã® enum <code>Shape</code> ã«å¯¾ã™ã‚‹ <code>enum_dispatch::enum_dispatch</code> å‘¼ã³å‡ºã—ã«ãŠã„ã¦,
enum <code>Shape</code> ã® token stream ã‚’æ–‡å­—åˆ—åŒ–ã—ãŸã‚‚ã®ã‚’ <code>HashMap</code> <code>ENUM_DEFS</code> ã«ä¿å­˜ã™ã‚‹
[<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/lib.rs?ref_type=tags#L382">code</a>]
[<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/cache.rs?ref_type=tags#L40-41"><code>ENUM_DEFS</code></a>].
ã“ã®ã¨ã generics ã®æƒ…å ±ã‚‚ä¸€éƒ¨ <code>HashMap</code> ã®ã‚­ãƒ¼ã¨ã—ã¦å«ã‚ã‚‹
[<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/cache.rs?ref_type=tags#L59-60">code</a>].</li>
<li>(2-1), (2-2) ã§å¼•æ•°ã¨ã—ã¦ enum/trait åãŒä¸ãˆã‚‰ã‚Œã¦ã„ãŸå ´åˆ (ä¸Šã§ã¯ (2-2)), ãã®çµ„ãŒä¸¡æ–¹å®šç¾©ã•ã‚Œã¦ã„ã‚Œã°è‡ªå‹• delegation ã™ã‚‹.
ãã†ã§ãªã‘ã‚Œã° <sup class="footnote-reference"><a href="#201">1</a></sup> defer ã™ã‚‹
[<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/lib.rs?ref_type=tags#L421-430">code</a>].</li>
<li>(2-1), (2-2) ã§ defer ã—ãŸçµ„ãŒè§£æ±ºã•ã‚ŒãŸã¨ã, è‡ªå‹• delegation ã™ã‚‹ <sup class="footnote-reference"><a href="#202">2</a></sup>
[<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/lib.rs?ref_type=tags#L440-457">code</a>].</li>
</ol>
<p>æœ€åˆã«ã“ã®å‡¦ç†ã‚’è¦‹ãŸã¨ãã¯æ„Ÿå‹•ã—ã¾ã—ãŸ. ã€Œã“ã‚Œã£ã¦åˆæ³•ãªã‚“ã !!ã€ã¨.
ã§ã‚‚å®Ÿã¯åˆæ³•ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ.</p>
<p><a href="https://users.rust-lang.org/t/what-do-you-suggest-proc-macros-to-be-aware-of-each-other-as-opposed-to-a-static-variable/77160/6">What do you suggest proc macros to be aware of each other as opposed to a static variable?</a>
ã‹ã‚‰å¼•ç”¨:</p>
<blockquote>
<p>bjorn3<br />
Jun 2022</p>
<p>Proc macros should be expandable independently and without any side effects. We don't offer any guarantees around the order and amount of times a proc macro is expanded. For example rust-analyzer will only re-expand proc macros if you change the actual invocation of the proc macro. Rustc could also start caching proc macro outputs in the future I think.</p>
</blockquote>
<p>æ„ç´„:</p>
<blockquote>
<p>proc macro ã¯å‰¯ä½œç”¨ã‚’æŒãŸãšã«ç‹¬ç«‹ã—ã¦å±•é–‹ã•ã‚Œã‚‹ã¹ãã§ã™.
proc macro ã®å±•é–‹ã«ãŠã„ã¦ãã®é †åºã‚‚å‘¼ã³å‡ºã—å›æ•°ã‚‚ä½•ã‚‚ä¿è¨¼ã•ã‚Œã¾ã›ã‚“.
ä¾‹ãˆã° rust-analyzer ã¯ proc macro ã®å‘¼ã³å‡ºã—ç®‡æ‰€ã®å¤‰æ›´æ¯ã«å†å±•é–‹ã•ã‚Œã¾ã™.
å°†æ¥çš„ã«ã¯ rustc ãŒ proc macro å‡ºåŠ›ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ <sup class="footnote-reference"><a href="#203">3</a></sup>.</p>
</blockquote>
<p>ã“ã‚Œã«ç…§ã‚‰ã—ã¦ä¸Šè¨˜ã®æ–¹æ³•ã‚’è©•ä¾¡ã—ã¦ã¿ã¾ã—ã‚‡ã†.</p>
<ul>
<li>ãã‚‚ãã‚‚ proc macro å‘¼ã³å‡ºã—æ™‚ global variable ãŒã©ã†ã„ã†çŠ¶æ…‹ã‹ä½•ã‚‚ä¿è¨¼ã•ã‚Œã¦ã„ãªã„.
(ä¾‹ãˆã°å‘¼ã³å‡ºã—æ¯ã«æ–°ã—ã„ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã™ã‚‹ã®ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®æŒ™å‹•ã¨ã—ã¦åˆæ³•.)
ä»¥ä¸‹ã§ã¯çŠ¶æ…‹ãŒä¿å­˜ã•ã‚Œã¦ã„ã¦ä¸€éƒ¨ rustc ã¨æŒ™å‹•ãŒé•ã†ã¨ä»®å®šã™ã‚‹.</li>
<li>é †åºä¸å®š: defer ã—ã¦ã„ã‚‹ã“ã¨ã«ã‚ˆã‚Š trait/enum ã®é †åºãŒé€†ã«ãªã£ã¦ã‚‚å•é¡Œãªã„ (ã¯ãš).</li>
<li>è¤‡æ•°å›å‘¼ã³å‡ºã—: <code>cache_trait()</code>, <code>cache_enum_dispatch()</code> ã¯
<a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html#method.insert"><code>HashMap::insert()</code></a>
ã‚’åˆ©ç”¨ã—ã¦ãŠã‚Š, key ãŒé‡è¤‡ã™ã‚‹å ´åˆã¯æ›´æ–°ã•ã‚Œã‚‹ã®ã§ä¸­èº«ã®å¤‰æ›´ã¯å¤§ä¸ˆå¤« (ãªã¯ãš).
trait/enum åã‚„å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¼„ã£ãŸå ´åˆã¯å¤ã„å®šç¾©ãŒåˆ¥ã‚¨ãƒ³ãƒˆãƒªã¨ã—ã¦æ®‹ã‚‹ã®ã§é§„ç›®.
ã¾ãŸ, (2-2) -&gt; (2-1) -&gt; (2-1) ã§è©•ä¾¡ã•ã‚ŒãŸå ´åˆæœ€åˆã® (2-1) ã§ defer ãŒ
<a href="https://gitlab.com/antonok/enum_dispatch/-/blob/v0.3.13/src/cache.rs?ref_type=tags#L131-134">æ¶ˆè²»</a>
ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰é§„ç›® (ãªã¯ãš) <sup class="footnote-reference"><a href="#204">4</a></sup>.</li>
<li>ã‚­ãƒ£ãƒƒã‚·ãƒ¥: ã‚­ãƒ£ãƒƒã‚·ãƒ¥å˜ä½“ã§ç•°å¸¸ã‚±ãƒ¼ã‚¹ã¯ãªã„æ°—ãŒã™ã‚‹? (ã¾ãã§ã‚‚å‰¯ä½œç”¨ãªã—ã¨ã„ã†é‡å¤§ãªå‰ææ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ãªã„ã®ã§...)</li>
</ul>
<p>...ã¨, å…¨ä½“çš„ã«ã‚ˆã‚ã—ããªã„ã§ã™.</p>
<hr />
<p>ãµãŸã¤ã‚ã® enum_dispatch ã®è‰¯ããªã„éƒ¨åˆ†ã¨ã—ã¦, å¤–éƒ¨ crate ã® trait ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ã¨ã„ã†ã“ã¨ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™.</p>
<p>ã‚ã‚‹ crate ã§ <code>enum_dispatch::enum_dispatch</code> ã‚’ä½¿ã„
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/src/lib.rs">1</a>],
åˆ¥ã® crate ã§åŒã˜ identifier ã«å¯¾ã—ã¦ä½¿ã£ã¦ã‚‚
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/pass_basic.rs">2</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/pass_def_in_other_mod_without_arg_incorrect.rs">3</a>]
ãã‚Œè‡ªä½“ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ã¯ãªã‚Šã¾ã›ã‚“.
ä¸€æ–¹, åŒä¸€ crate å†…ã§åŒã˜ identifier ã«å¯¾ã—ã¦ä½¿ã†ã¨æ„å›³ã›ã¬æŒ™å‹•ã«ãªã‚Šã¾ã™
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_def_in_other_mod_with_arg.rs">4 rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_def_in_other_mod_with_arg.stderr">4 stdeerr</a>].</p>
<p>ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ trait/enum ã® identifier (åå‰) ã‚’ <code>HashMap</code> ã®ã‚­ãƒ¼ã¨ã—ã¦åˆ©ç”¨ã—, ãã‚Œã‚’ module æ¯ã«åŒºåˆ¥ã—ã¦ã„ãªã„ã®ãŒåŸå› ã§ã™.
(å®Ÿè£…ãŒãƒŠã‚¤ãƒ¼ãƒ´ã™ãã‚‹.)</p>
<p>ã“ã®å·®ã¯ compilation unit (crate) ã‚’è·¨ã„ã§ã„ã‚‹ã¨ãã« global variable ã‚’å¼•ãç¶™ã„ã§ã„ãªã„ã‹ã‚‰ã ã¨æ€ã‚ã‚Œã¾ã™ <sup class="footnote-reference"><a href="#205">5</a></sup>.
é€†ã«è¨€ãˆã°, <strong>å¼•ãç¶™ã’ãªã„</strong> ã¨ã„ã†ã“ã¨ã§ã‚‚ã‚ã‚Šã¾ã™.</p>
<p>ã¨ã„ã†ã‚ã‘ã§, <strong>global variable ã‚’ä½¿ã†æ–¹æ³•ã§ã¯ç•°ãªã‚‹ proc macro é–“ã§æƒ…å ±ã‚’ä¼é”ã§ãã¾ã›ã‚“</strong>.</p>
<hr />
<p>ã¿ã£ã¤ã‚. generics ã‚„ trait bound ãªã©ã®ã‚µãƒãƒ¼ãƒˆãŒå¼±ã„.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">struct </span><span>Rect&lt;T&gt; {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: T,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: T,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">enum_dispatch</span><span>::</span><span style="color:#bf616a;">enum_dispatch</span><span>]
</span><span style="color:#b48ead;">enum </span><span>Shape&lt;T&gt; {
</span><span>    Rect(Rect&lt;T&gt;),
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">enum_dispatch</span><span>::</span><span style="color:#bf616a;">enum_dispatch</span><span>(Shape&lt;usize&gt;)] </span><span style="color:#65737e;">// (2-3)
</span><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl</span><span>&lt;T&gt; ShapeI </span><span style="color:#b48ead;">for </span><span>Rect&lt;T&gt;
</span><span style="color:#b48ead;">where
</span><span>    T: std::ops::Mul,
</span><span>{
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        (</span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height) as </span><span style="color:#b48ead;">f64
</span><span>    }
</span><span>}
</span></code></pre>
<p>ã“ã‚Œã§ (2-3) ã§ä»¥ä¸‹ã®æ§˜ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œ,</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">impl</span><span>&lt;T&gt; ShapeI </span><span style="color:#b48ead;">for </span><span>Shape&lt;T&gt; {
</span><span>    #[</span><span style="color:#bf616a;">inline</span><span>]
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#b48ead;">match </span><span style="color:#bf616a;">self </span><span>{
</span><span>            Shape::Rect(inner) =&gt; ShapeI::area(inner),
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p><code>T: std::ops::Mul</code> ã¨ã„ã†åˆ¶ç´„ãŒä»˜ã„ã¦ã„ãªã„ã®ã§ã‚¨ãƒ©ãƒ¼
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_generics.rs">rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_generics.stderr">stderr</a>]
ã«ãªã‚Šã¾ã™.</p>
<p>ã“ã‚Œã¯å˜ç´”ã«å®Ÿè£…ã®å•é¡Œã§ã™. 3ç« ã§è­°è«–ã—ã¾ã™.</p>
<hr />
<h4 id="enum-dispatch-matome"><code>enum_dispatch</code> ã¾ã¨ã‚</h4>
<ul>
<li>enum_dispatch ã¯ <strong>proc macro crate ä¸­ã® global variables ã«æ–‡å­—åˆ—åŒ–ã—ãŸ trait/enum ã®å®šç¾©ã‚’ä¿å­˜ã™ã‚‹</strong>
ã“ã¨ã§ proc macro é–“ã§æƒ…å ±ä¼é”ã—ã¦ã„ã‚‹ãŒ, ã“ã®æ–¹æ³•ã¯æ ¹æœ¬çš„ãªå•é¡ŒãŒã‚ã‚‹.</li>
<li>å¤–éƒ¨ crate ã® trait/enum å®šç¾©ã‚’æ‰±ãˆãªã„.</li>
<li>generics ã‚„ trait bound ã®ã‚µãƒãƒ¼ãƒˆãŒå¼±ã„.</li>
<li>ã‚¨ãƒ©ãƒ¼ãŒã‚ã‹ã‚Šã«ãã„
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_implicit_error_if_typo.rs">rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_implicit_error_if_typo.stderr">stderr</a>].
è»½ç‡ã« panic ã™ã‚‹
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_panic_if_struct.rs">rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_panic_if_struct.stderr">stderr</a>].</li>
</ul>
<p>ã¨ã„ã†ã‚ã‘ã§ <code>enum_dispatch</code> ã¯å€‹äººçš„ã«ã¯ãŠã™ã™ã‚ã—ã¾ã›ã‚“. R.I.P. <sup class="footnote-reference"><a href="#206">6</a></sup> <sup class="footnote-reference"><a href="#207">7</a></sup></p>
<h3 id="local-state-for-proc-macro">é–‘è©±ä¼‘é¡Œ: proc macro ã§éæ¿€ãªã“ã¨ã‚’ã‚„ã‚ŠãŸã„</h3>
<p>äººé–“ã®æ¬²æ±‚ã¯åº•ãªã—ã§ã™.
ã€Œã“ã†ã—ãŸã„ã€ã€Œã“ã“ã§ã“ã‚ŒãŒä½¿ãˆã‚Œã°ã“ã‚ŒãŒä½œã‚Œã‚‹ã®ã«ã€ã€Œåˆæ³•ã˜ã‚ƒãªã„ã‘ã©é™å®šçš„ã«å‹•ä½œã™ã‚‹ã‚‚ã®ã‚’ä½œã£ã¦ã¿ãŸã€
ãã‚‰ã„ãªã‚‰ã©ã‚“ã©ã‚“è¨€ã£ãŸã‚Šã‚„ã£ãŸã‚Šã—ã¦ã„ãã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™.</p>
<p>ä»Šå›ã®ãƒ†ãƒ¼ãƒã§ã‚ã‚‹è‡ªå‹• delegation ã¨ã„ã†æ–‡è„ˆã‹ã‚‰å°‘ã—å¤–ã‚Œã¾ã™ãŒ, ã€Œã‚‚ã£ã¨ä¸€èˆ¬ã«æƒ…å ±ä¼é”ã—ãŸã„ã€ã€ŒçŠ¶æ…‹ã‚’æŒã¡ãŸã„ã€
ã¨ã„ã†è¦æœ›ã¯ã¡ã‚‰ã»ã‚‰ã¨ä¸ŠãŒã£ã¦ã„ã¾ã™. ç›®ã«å…¥ã£ãŸã‚‚ã®ã‚’æŒ™ã’ã¦ã„ãã¾ã™.</p>
<ul>
<li><a href="https://users.rust-lang.org/t/what-do-you-suggest-proc-macros-to-be-aware-of-each-other-as-opposed-to-a-static-variable/77160">What do you suggest proc macros to be aware of each other as opposed to a static variable?</a></li>
<li><a href="https://github.com/rust-lang/rust/issues/44034">Crate local state for procedural macros?</a></li>
<li><a href="https://stackoverflow.com/questions/52910783/is-it-possible-to-store-state-within-rusts-procedural-macros">Is it possible to store state within Rust's procedural macros?</a></li>
<li>ã¡ã‚‡ã£ã¨ã‚ªãƒ•ãƒˆãƒ”ã ã‘ã© <a href="https://github.com/rust-lang/rust/issues/54363">proc macro ä¸­ã§ $crate ã‚’ä½¿ã„ãŸã„</a>
ãŸã‚ã« <a href="https://github.com/bkchr/proc-macro-crate/blob/master/src/lib.rs">Cargo.toml ã‚’èª­ã‚“ã§ã‚‹ã‚„ã¤</a>.</li>
</ul>
<p>ã§ã¯è‡ªå‹• delegation ã¯åˆæ³•çš„ã«ã¯ç„¡ç†ãªã®ã§ã—ã‚‡ã†ã‹? å®Ÿã¯åˆæ³•çš„ã«å®Ÿç¾ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™.</p>
<h3 id="enum-delegate-v0.2.0"><code>enum_delegate</code> v0.2.0</h3>
<ul>
<li><a href="https://crates.io/crates/enum_delegate">crates.io</a></li>
<li><a href="https://gitlab.com/dawn_app/enum_delegate">repository</a></li>
<li><a href="https://docs.rs/enum_delegate/0.2.0/enum_delegate">doc</a></li>
<li>Initial commit: 2022/10</li>
</ul>
<p>enum_delegate ã¯ enum_dispatch ã‚’æ”¹å–„ã—ãŸ crate (ã ã£ãŸã‚‚ã®) ã§ã™.
ã—ã‹ã— <a href="https://gitlab.com/dawn_app/enum_delegate/-/issues/6">ã“ã® PR</a> ã§ãƒ‡ã‚¶ã‚¤ãƒ³ãŒæ ¹æœ¬çš„ã«å¤‰ã‚ã‚Šã¾ã—ãŸ.
ãªã®ã§ã¾ãš v0.2.0 ã¾ã§ã®è©±ã‚’ã—ã¾ã™.</p>
<p><a href="https://docs.rs/enum_delegate/0.2.0/enum_delegate/#comparison-with-enum_dispatch">doc -- Comparison with enum_dispatch</a>
ã¨
<a href="https://gitlab.com/dawn_app/enum_delegate/tree/f5bcaf45#enum_dispatch">README</a>
ã«ã¯ä»¥ä¸‹ã®ç‚¹ãŒå·®åˆ†ã¨ã—ã¦æŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã™.</p>
<ul>
<li>enum_dispatch ã¯ enum ã®ã¿ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŒ, enum_delegate ã¯ <strong>enum/struct with a field</strong> ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹.</li>
<li><strong>å¤–éƒ¨ crate ã® trait</strong> ã‚’ã‚µãƒãƒ¼ãƒˆ</li>
<li>ã‚ˆã‚Šè‰¯ã„ã‚¨ãƒ©ãƒ¼
(ãªã‚“ã¨ã¡ã‚ƒã‚“ã¨ <a href="https://gitlab.com/dawn_app/enum_delegate/-/tree/0.2.0/tests_error">failure case ã®ãƒ†ã‚¹ãƒˆ</a> ãŒã‚ã‚‹!)</li>
<li>Associated types ã‚µãƒãƒ¼ãƒˆ</li>
</ul>
<p>ä½¿ã„æ–¹ã¯ enum_dispatch ã«è¿‘ã„ã§ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">enum_delegate</span><span>::</span><span style="color:#bf616a;">register</span><span>]          </span><span style="color:#65737e;">// (2-4)
</span><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">enum_delegate</span><span>::</span><span style="color:#bf616a;">implement</span><span>(ShapeI)] </span><span style="color:#65737e;">// (2-5)
</span><span style="color:#b48ead;">enum </span><span>Shape {
</span><span>    Rect(Rect),
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let</span><span> rect = Rect { width: </span><span style="color:#d08770;">2.0</span><span>, height: </span><span style="color:#d08770;">3.0 </span><span>};
</span><span>    assert_eq!(rect.</span><span style="color:#96b5b4;">area</span><span>(), </span><span style="color:#d08770;">6.0</span><span>);
</span><span>    </span><span style="color:#b48ead;">let</span><span> shape = Shape::Rect(rect);
</span><span>    assert_eq!(shape.</span><span style="color:#96b5b4;">area</span><span>(), </span><span style="color:#d08770;">6.0</span><span>);
</span><span>}
</span></code></pre>
<h4 id="enum-delegate-noqing-bao-chuan-da-fang-fa"><code>enum_delegate</code> ã®æƒ…å ±ä¼é”æ–¹æ³•</h4>
<p>æƒ…å ±ä¼é”ã®ä»•çµ„ã¿ã¯ <a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/How%20Does%20it%20Work.md">How Does it Work.md</a>
ã§è§£èª¬ã•ã‚Œã¦ã„ã¾ã™. ä»¥ä¸‹ã§è§£èª¬ã—ã¾ã™.</p>
<p>è‡ªå‹• delegation ã®ãŸã‚ã«ã¯</p>
<ul>
<li>trait <code>Trait</code> ã® path</li>
<li>trait <code>Trait</code> ã®å®šç¾©</li>
<li>struct/enum <code>StructEnum</code> ã® path</li>
<li>struct/enum <code>StructEnum</code> ã®å®šç¾©</li>
</ul>
<p>ãŒå¿…è¦ã§ã™.</p>
<p>å®šç¾©ãŒã‚ã£ã¦ã‚‚ path ã¯å¾—ã‚‰ã‚Œãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„.<br />
proc macro ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®ã‹ãªã‚Šæ—©ã„ãƒ•ã‚§ãƒ¼ã‚ºã§å±•é–‹ã•ã‚Œã¾ã™. ãªã®ã§åŸºæœ¬çš„ã«ä½¿ãˆã‚‹ã®ã¯å­—å¥æƒ…å ± (<code>TokenStream</code>) ã®ã¿ã§ã™.
ã‚ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ãŒå‹ãªã®ã‹ trait ãªã®ã‹å¤‰æ•°ãªã®ã‹ã‚„, äº‹å‰ã« <code>use</code> ã•ã‚Œã¦åˆ¥ã® module/crate ã‚’å‚ç…§ã—ã¦ã„ã‚‹ã®ã‹ã©ã†ã‹ãªã©ã¯ã‚ã‹ã‚Šã¾ã›ã‚“.
ä¸€æ–¹ã§ <code>impl path::to::Trait for path::of::StuctEnum { ... }</code> ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ã¯ trait ã¨ struct/enum ã® path ã‚’
ã©ã“ã‹ã—ã‚‰ã‹ã‚‰å¾—ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™. <code>enum_delegate::implement</code> ã®å ´åˆã¯ trait ã® path ã¯å¼•æ•°ã§ä¸ãˆã‚‰ã‚Œã¾ã™. struct/enum ã® path ã¯
ã“ã® macro ã¯ struct/enum ã®å®šç¾©ã«ä»˜ã‘ã‚‹ã¨ã„ã†è¨­è¨ˆã‹ã‚‰ ident <code>StructEnum</code> ã‚’ãã®ã¾ã¾ä½¿ãˆã°ã‚ˆã„ã§ã™:
<code>impl path::to::Trait for StuctEnum { ... }</code>.</p>
<p>æ®‹ã‚Šã¯ trait ã®å®šç¾©ã®ã¿ã§ã™. enum_delegate ã¯ <strong>proc macro ä¸­ã§ decl macro ã‚’çµŒç”±ã™ã‚‹</strong> ã“ã¨ã§ proc macro é–“ã§æƒ…å ±ã‚’ä¼é”ã—ã¾ã™.</p>
<p>ä¸Šè¨˜ã®ä¾‹ã§ã¯ä»¥ä¸‹ãŒèµ·ã“ã‚Šã¾ã™:</p>
<ol>
<li>(2-4) ã® trait <code>ShapeI</code> ã«å¯¾ã™ã‚‹ <code>#[enum_delegate::register]</code> å‘¼ã³å‡ºã—ã«ãŠã„ã¦,
trait <code>ShapeI</code> ã®ä»–ã« decralative macro <code>ShapeI</code> ã‚’å®šç¾©ã™ã‚‹. (å¾Œè¿°)</li>
<li>(2-5) ã® enum <code>Shape</code> ã«å¯¾ã™ã‚‹ <code>#[enum_delegate::implement(ShapeI)]</code> å‘¼ã³å‡ºã—ã«ãŠã„ã¦,
decl macro <code>ShapeI</code> ã‚’å‘¼ã³å‡ºã™
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/enum_delegate_lib/src/macros/implement.rs#L65">1</a>].
ã“ã“ã§ trait ã®å®šç¾©ã‚’ç²å¾—ã™ã‚‹.</li>
<li>ãã®ä¸­ã§ proc macro <code>enum_delegate::implement_trait_for_enum!{}</code> ã‚’å‘¼ã³å‡ºã™.
ã“ã‚ŒãŒ <code>impl ShapeI for Shape { ... }</code> ã‚’ç”Ÿæˆã™ã‚‹
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/src/lib.rs#L141">2</a>]
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/enum_delegate_lib/src/macros/implement_trait_for_enum.rs#L43">3</a>].</li>
</ol>
<p>decl macro <code>ShapeI</code> ã¯
<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/enum_delegate_lib/src/macros/implement.rs#L65">ã“ã®æ§˜ã«å®šç¾©</a> ã•ã‚Œã‚‹:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>quote! {
</span><span>    #[</span><span style="color:#bf616a;">doc</span><span>(hidden)]
</span><span>    #[</span><span style="color:#bf616a;">macro_export</span><span>]
</span><span>    macro_rules! #macro_name {
</span><span>        (</span><span style="color:#bf616a;">$trait_path</span><span>: path, </span><span style="color:#bf616a;">$enum_path</span><span>: path, </span><span style="color:#bf616a;">$enum_declaration</span><span>: item) =&gt; {
</span><span>            enum_delegate::implement_trait_for_enum!{
</span><span>                </span><span style="color:#bf616a;">$trait_path</span><span>,
</span><span>                #parsed_trait,
</span><span>                </span><span style="color:#bf616a;">$enum_path</span><span>,
</span><span>                </span><span style="color:#bf616a;">$enum_declaration
</span><span>            }
</span><span>        };
</span><span>    }
</span><span>
</span><span>    #[</span><span style="color:#bf616a;">doc</span><span>(hidden)]
</span><span>    </span><span style="color:#b48ead;">pub use </span><span>#macro_name as #trait_name;
</span><span>
</span><span>    #cleaned_trait
</span><span>}
</span></code></pre>
<p>ã“ã‚Œã¯ <code>(trait ã® path, struct/enum ã® path, struct/enum ã®å®šç¾©)</code> ã‚’å¼•æ•°ã«å–ã‚Š,
ãã“ã« trait ã®å®šç¾© <code>parsed_trait</code> ã‚’åˆã‚ã›ã¦ <code>enum_delegate::implement_trait_for_enum!{}</code>
ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã ã‘ã§ã‚ã‚‹. (æ¦‚ã­)</p>
<h4 id="he-gu-dong-kunoka">ä½•æ•…å‹•ãã®ã‹?</h4>
<p>ã“ã‚Œã¯ global variable ã‚’ä½¿ã†æ–¹æ³•ã¨ã¯é•ã„, åˆæ³•ã§ã‚ã‚‹. ä½•æ•…ã ã‚ã†ã‹?</p>
<ul>
<li>å‰¯ä½œç”¨ãŒãªã, æ¸¡ã•ã‚ŒãŸ <code>TokenStream</code> ä»¥å¤–ã®æƒ…å ±ã‚’ä½¿ã£ã¦ã„ãªã„.</li>
<li>é †åºä¸å®š: <code>#[enum_delegate::implement(ShapeI)]</code> ãŒå…ˆã«å‘¼ã³å‡ºã•ã‚ŒãŸã¨ã—ã¦ã‚‚å†…å´ã® decl macro <code>ShapeI</code>
ã®å±•é–‹ã¯ãã®å®šç¾©ã®æ–¹ãŒå…ˆã«è§£æ±ºã•ã‚Œã‚‹ (ã¯ãš <sup class="footnote-reference"><a href="#208">8</a></sup>).</li>
<li>è¤‡æ•°å›å‘¼ã³å‡ºã—: å‰¯ä½œç”¨ãŒãªã„ã®ã§å¤§ä¸ˆå¤«.</li>
<li>ã‚­ãƒ£ãƒƒã‚·ãƒ¥: decl macro ã®å®šç¾©ãŒå¤‰æ›´ã•ã‚Œã‚Œã°é©åˆ‡ã« invalidate ã•ã‚Œã‚‹ã¨æœŸå¾…ã§ãã‚‹.</li>
</ul>
<h4 id="dehahe-gu-enum-delegate-debu-man-nanoka">ã§ã¯ä½•æ•… <code>enum_delegate</code> ã§ä¸æº€ãªã®ã‹?</h4>
<p>å°‘ãªãã¨ã‚‚
generics
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/tests_error/unsupported_generic.rs">rs</a>]
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/tests_error/unsupported_generic.stderr">stderr</a>],
super trait
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/tests_error/unsupported_supertrait.rs">rs</a>]
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/tests_error/unsupported_supertrait.stderr">stderr</a>]
<sup class="footnote-reference"><a href="#209">9</a></sup>,
trait item
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/tests_error/unsupported_trait_item.rs">rs</a>]
[<a href="https://gitlab.com/dawn_app/enum_delegate/-/blob/0.2.0/tests_error/unsupported_trait_item.stderr">stderr</a>]
ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ <sup class="footnote-reference"><a href="#210">10</a></sup>.</p>
<p>ã¾ãŸ, trait å®šç¾©ãŒå¤–éƒ¨ crate ã«ã‚ã‚Š <code>#[enum_delegate::register]</code> ã‚’ä»˜ã‘ã‚‰ã‚Œãªã„ã¨ã„ã†ã“ã¨ã¯æ™®é€šã«ã‚ã‚Šã¾ã™.
ãã®ã¨ãã¯ <code>enum_delegate::implement</code> ã«ç›´æ¥ trait å®šç¾©ã‚’é£Ÿã‚ã›ã¾ã™
[<a href="https://docs.rs/enum_delegate/0.2.0/enum_delegate/#3rd-party-traits">doc</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_delegate_v020/pass_implement_extarnal_trait.rs">example</a>]:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">mod </span><span>external {
</span><span>    </span><span style="color:#b48ead;">pub trait </span><span>ShapeI {
</span><span>        </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">enum_delegate</span><span>::</span><span style="color:#bf616a;">implement</span><span>(
</span><span>    external::ShapeI,
</span><span>    trait ShapeI {
</span><span>        fn </span><span style="color:#bf616a;">area</span><span>(&amp;self) -&gt; f64;
</span><span>    }
</span><span>)]
</span><span style="color:#b48ead;">enum </span><span>Shape {
</span><span>    Rect(Rect),
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>external::ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span></code></pre>
<p>ã“ã‚Œã«ã¯ã„ãã¤ã‹é¢å€’ãªãƒã‚¤ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™. 3ç« ã§å†è¨ªã—ã¾ã™.</p>
<h4 id="enum-delegate-v0-2-0-matome"><code>enum_delegate</code> v0.2.0 ã¾ã¨ã‚</h4>
<ul>
<li>enum_delegate ã¯ <strong>proc macro ä¸­ã§ decl macro ã‚’çµŒç”±ã™ã‚‹</strong> ã“ã¨ã§ proc macro é–“ã§æƒ…å ±ã‚’ä¼é”ã™ã‚‹.
ã“ã‚Œã¯å•é¡ŒãŒãªã„ <sup class="footnote-reference"><a href="#211">11</a></sup>.</li>
<li>generics ã‚„ trait bound ã®ã‚µãƒãƒ¼ãƒˆãŒå¼±ã„.</li>
<li>å¤–éƒ¨ crate ã® trait ã®æ‰±ã„ãŒé¢å€’.</li>
</ul>
<p>ã‚ã‚ŠãŒã¨ã† <code>enum_delegate</code>, å‹‰å¼·ã«ãªã£ãŸã‚ˆ. ã§ã‚‚åˆ¥æ–¹å‘ã«è¡Œã£ã¡ã‚ƒã£ãŸã‚“ã ã‚ˆãªã. R.I.P.</p>
<h3 id="auto-delegate"><code>auto-delegate</code></h3>
<ul>
<li><a href="https://crates.io/crates/auto-delegate">crates.io</a></li>
<li><a href="https://github.com/not-elm/auto-delegate">repository</a></li>
<li><a href="https://docs.rs/auto-delegate/0.1.3/auto_delegate">doc</a></li>
<li>Initial commit: 2023/05</li>
</ul>
<p>enum_delegate v0.3.0 ã®ä»•çµ„ã¿ã®è§£èª¬ã®å‰ã«, ã‚ˆã‚Šç´ æœ´ãª auto-delegate ã‚’å–ã‚Šä¸Šã’ã¾ã™.</p>
<p><a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/auto-delegate/pass_basic.rs">ä½¿ã„æ–¹</a>:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">auto_delegate</span><span>::</span><span style="color:#bf616a;">delegate</span><span>]         </span><span style="color:#65737e;">// (2-6)
</span><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(auto_delegate::Delegate)] </span><span style="color:#65737e;">// (2-7)
</span><span>#[</span><span style="color:#bf616a;">to</span><span>(ShapeI)]
</span><span style="color:#b48ead;">enum </span><span>Shape {
</span><span>    Rect(Rect),
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span></code></pre>
<h4 id="qing-bao-chuan-da-noshi-zu-mi-impl-trait-for-auto-delegate-delegates">æƒ…å ±ä¼é”ã®ä»•çµ„ã¿: <code>impl Trait for auto_delegate::Delegates&lt;...&gt;</code></h4>
<p>auto-delegate ã¯ <strong><code>auto_delegate::Delegates&lt;...&gt;</code> ã¨ã„ã† struct ã‚’ä»‹ã—ã¦è‡ªå‹• delegation ã™ã‚‹</strong>.</p>
<p><a href="https://github.com/not-elm/auto-delegate/blob/v0.1.3/src/lib.rs#L6-L20">auto-delegate/src/lib.rs</a>:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">doc</span><span>(hidden)]
</span><span style="color:#b48ead;">pub struct </span><span>Delegates&lt;A, B, C, D, E, F, G, H, I, J, K, L&gt;(
</span><span>    pub Option&lt;A&gt;,
</span><span>    pub Option&lt;B&gt;,
</span><span>    pub Option&lt;C&gt;,
</span><span>    pub Option&lt;D&gt;,
</span><span>    pub Option&lt;E&gt;,
</span><span>    pub Option&lt;F&gt;,
</span><span>    pub Option&lt;G&gt;,
</span><span>    pub Option&lt;H&gt;,
</span><span>    pub Option&lt;I&gt;,
</span><span>    pub Option&lt;J&gt;,
</span><span>    pub Option&lt;K&gt;,
</span><span>    pub Option&lt;L&gt;,
</span><span>);
</span></code></pre>
<ol>
<li>(2-6) ã§ <code>#[auto_delegate::delegate]</code> ã™ã‚‹ã¨ <code>impl ShapeI for auto_delegate::Delegates&lt;...&gt;</code> ãŒå®šç¾©ã•ã‚Œã‚‹.
ä¾‹ãˆã° receiver ãŒ <code>&amp;self</code> ã®å ´åˆ:
[<a href="https://github.com/not-elm/auto-delegate/blob/v0.1.3/impl/src/delegate_trait.rs#L65-L89">gen 1</a>]
[<a href="https://github.com/not-elm/auto-delegate/blob/v0.1.3/impl/src/trait_meta/fn_meta.rs#L39">gen 2</a>]
[<a href="https://github.com/not-elm/auto-delegate/blob/v0.1.3/impl/src/trait_meta/fn_meta.rs#L79-L82">gen 3</a>].
(ã©ã“ã‹ã²ã¨ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ <code>Some</code> ã§ã‚ã‚‹ã“ã¨ãŒä»®å®šã•ã‚Œã¦ã„ã‚‹.)</li>
<li>(2-7) ã§ <code>#[derive(auto_delegate::Delegate)]</code> ã™ã‚‹ã¨, <code>impl ShapeI for Shape</code> ã®ä¸­ã§ <code>&amp;self</code> ãªã©ã‚’
<code>auto_delegate::Delegates&lt;variant, ...&gt;</code> ã«å¤‰æ›ã—
[<a href="https://github.com/not-elm/auto-delegate/blob/v0.1.3/impl/src/derive/enum.rs#L84-L91">enum</a>]
[<a href="https://github.com/not-elm/auto-delegate/blob/v0.1.3/impl/src/derive/struct.rs#L124-L126">struct</a>],
(2-6) ã® <code>#[auto_delegate::delegate]</code> ã§å®šç¾©ã•ã‚Œã¦ã„ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³ã ã™
[<a href="https://github.com/not-elm/auto-delegate/blob/v0.1.3/impl/src/trait_meta/fn_meta.rs#L107-L145">gen 4</a>].
å„ enum variant ãŒ <code>auto_delegate::Delegates</code> ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¯¾å¿œã™ã‚‹ <sup class="footnote-reference"><a href="#212">12</a></sup>.</li>
</ol>
<p>å‰ã®ãµãŸã¤ã¨ã¯ç•°ãªã‚Š proc macro é–“ã§ <code>TokenStream</code> ã‚’å—ã‘æ¸¡ã™ã®ã§ã¯ãªã,
<strong>rustc ã«å‹ã¨é–¢æ•°å‘¼ã³å‡ºã—ã‚’è§£æ±ºã•ã›ã‚‹ã“ã¨ã«ã‚ˆã‚Š trait ã¨ struct/enum ã‚’è¡Œãæ¥ã—ã¦ã„ã‚‹</strong> ã¨ã„ã†ã®ãŒã‚­ãƒ¢ã§ã‚ã‚‹.
proc macro ã¯ãã®å¾¡è†³ç«‹ã¦ã‚’ã—ã¦ã„ã‚‹ã«ã™ããªã„.</p>
<p>ã“ã®å½¢å¼ã¯ <a href="https://github.com/rust-lang/rfcs/pull/2393#issuecomment-392248367">rfcs#2329 ã®ã‚³ãƒ¡ãƒ³ãƒˆ</a> (2018/05)
ã§ææ¡ˆã•ã‚Œã¦ã„ã¾ã™.</p>
<h4 id="ping-jia">è©•ä¾¡</h4>
<p>ã“ã®æ–¹æ³•ã«ã¯è‡´å‘½çš„ãªæ¬ ç‚¹ãŒã¿ã£ã¤ã‚ã‚‹.</p>
<hr />
<p>ã²ã¨ã¤ã‚. delegatee ãŒ crate local ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹å‹ã§ãªã‘ã‚Œã° trait ã®å®Ÿè£…ãŒã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã™ã‚‹ã“ã¨
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/auto-delegate/fail_conflict_impl_trait_for_field.rs">rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/auto-delegate/fail_conflict_impl_trait_for_field.stderr">stderr</a>].</p>
<p><code>#[auto_delegate::delegate] pub trait Hello {...}</code> ã®æ™‚ç‚¹ã§ç”Ÿæˆã•ã‚Œã‚‹ä¸­ç¶™ã¨ãªã‚‹å®šç¾©ã®åŸºæœ¬å½¢ã¯æ¬¡ã§ã™:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">impl</span><span>&lt;DelegateImpl&gt; Hello </span><span style="color:#b48ead;">for </span><span>DelegateImpl
</span><span style="color:#b48ead;">where
</span><span>    DelegateImpl: auto_delegate::Delegatable&lt;</span><span style="background-color:#bf616a;color:#2b303b;">.</span><span>..&gt;,
</span><span>    &lt;DelegateImpl as auto_delegate::Delegatable&lt;</span><span style="background-color:#bf616a;color:#2b303b;">..</span><span>.&gt;&gt;::A: Hello,
</span><span>    ...
</span><span>    &lt;DelegateImpl as auto_delegate::Delegatable&lt;</span><span style="background-color:#bf616a;color:#2b303b;">..</span><span>.&gt;&gt;::L: Hello,
</span></code></pre>
<p>ã“ã‚Œã¨è‡ªåˆ†ã§å®šç¾©ã—ãŸ <code>impl Hello for String</code> ãŒã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã—ã¾ã™.
(å°†æ¥çš„ã« auto_delegate ãŒ <code>impl DelegateImpl for String</code> ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ rustc ã¯ã“ã‚Œã‚’ reject ã›ã–ã‚‹ã‚’å¾—ãªã„.)</p>
<hr />
<p>ãµãŸã¤ã‚. å¤–éƒ¨ crate ã® trait ã«å¯¾ã—ã¦å¾Œä»˜ã‘ã§ããªã„.</p>
<p>struct/enum ãŒ crate å†…ã§å®šç¾©ã•ã‚Œã¦ã„ãŸã¨ã—ã¦ã‚‚, ã“ã®ä»•çµ„ã¿ã§ã¯ <code>impl external::Trait for auto_delegate::Delegates&lt;...&gt;</code>
ã‚’çµŒç”±ã›ã–ã‚‹ã‚’å¾—ã¾ã›ã‚“. trait <code>external::Trait</code> ã«å¯¾ã—ã¦ <code>external</code> å´ã§ã¯ <code>#[auto_delegate::delegate]</code> ãŒä»˜ã‘ã‚‰ã‚Œã¦ã„ãªã„å ´åˆ
(enum_delegate ã§ trait å®šç¾©ã‚’ç›´æ›¸ãã—ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹), ã“ã®åŒæ–¹ã¯ non local ã§ã‚ã‚Šç‰¹æ®Šãªå ´åˆã‚’é™¤ã
<a href="https://doc.rust-lang.org/reference/items/implementations.html#trait-implementation-coherence">orphan rule</a>
ã«åã—ã¾ã™.</p>
<hr />
<p>ã¿ã£ã¤ã‚. macro å±•é–‹çµæœãŒã‹ãªã‚Šèª­ã¿é›£ã„ã¨ã„ã†ã“ã¨
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/auto-delegate/pass_basic.rs">example</a>].</p>
<p>ã“ã‚Œã¯å˜ã«èª­ã¿é›£ã„ã¨ã„ã†ã ã‘ã®å•é¡Œã§ã¯ãªã„. ä¾‹ãˆã°ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã¨ãã« (proc macro ã‚„ã“ã®ä»•çµ„ã¿ã‚’çŸ¥ã£ã¦ã„ã‚‹ã¨ã¯é™ã‚‰ãªã„)
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè§£æ±ºã—ã‚„ã™ã„ã‚ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã›ãªã„ã¨ã„ã£ãŸ practical ãªå•é¡Œã‚’å­•ã‚“ã§ã„ã‚‹.
(ä¾‹ãˆã°ä¸Šã®ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã—ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/auto-delegate/fail_conflict_impl_trait_for_field.stderr">stderr</a>]
ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã©ã†ã™ã‚Œã°è§£æ±ºã§ãã‚‹ã®ã‹, ãã‚‚ãã‚‚è§£æ±ºå¯èƒ½ãªã®ã‹ãŒã‚ã‹ã‚‹ã ã‚ã†ã‹?
ã‚‚ã¡ã‚ã‚“ <code>cargo expand</code> ã—ã¦å®Ÿè£…ã‚’èª­ã‚ã°ã‚ã‹ã‚‹ãŒ, ãã‚Œã¯æœ€çµ‚æ‰‹æ®µã§ã‚ã‚‹.)</p>
<hr />
<p>ã‚ã¨è‡´å‘½çš„ã¨è¨€ã†ã¹ãã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒ, å…¨ä½“çš„ã«æŸ”è»Ÿæ€§ã«æ¬ ã‘ã¾ã™.
ä¾‹ãˆã° associated type ã¯ç¬¬ä¸€ variant ã®ã‚‚ã®ã‚’ä½¿ã£ã¦ã„ã¾ã™
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/auto-delegate/fail_not_supported_associated_const.rs">rs</a>].
ã—ã‹ã— associated type ã¯ã¨ã‚‚ã‹ã (enum variant æ¯ã«é•ã£ã¦ã„ã‚‹ã‚‚ã®ã‚’çºã‚ãŸã„ã‚±ãƒ¼ã‚¹ã‚’æ€ã„ã¤ã‹ãªã„) associated const ã¯ delegator å´ã§æ–°ã—ãå®šç¾©ã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒå‡ºã¦ãã‚‹ã“ã¨ã‚’å¦å®šã§ãã¾ã›ã‚“.
å°‘ãªãã¨ã‚‚å¤–éƒ¨ crate ã§ trait ãŒå®šç¾©ã•ã‚Œã¦ã„ã¦ associated const ã‚’æŒã¤ã‚±ãƒ¼ã‚¹ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãƒãƒƒãƒã‚’é–‹ã‘ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™.
(æƒ³å®šã•ã‚Œã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ãŒç´ æœ´ã™ãã‚‹. ç¾å ´ã§ä½¿ã‚ã‚Œã‚‹ãŸã‚ã«ã¯å®Œç’§ãªã‚‚ã®ã‹ãƒ€ã‚¯ãƒˆãƒ†ãƒ¼ãƒ—ã§é‹ç”¨ã§ãã‚‹ã‚‚ã®ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹.)</p>
<h4 id="auto-delegate-matome"><code>auto-delegate</code> ã¾ã¨ã‚</h4>
<ul>
<li><code>impl</code> ãŒã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹.</li>
<li>å¤–éƒ¨ crate ã® trait ãŒæ‰±ãˆãªã„.</li>
<li>ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ãŒéè‡ªæ˜.</li>
<li>æŸ”è»Ÿæ€§ã«æ¬ ã‘ã‚‹.</li>
</ul>
<p>ä»•çµ„ã¿ã®åˆ¶ç´„ãŒãã¤ã™ãã‚‹. é»’é­”è¡“ã‚’ä½¿ã†ãªã‚‰ãã®åŸç†ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã»ã—ã„. R.I.P. <sup class="footnote-reference"><a href="#213">13</a></sup></p>
<h3 id="enum-delegate-v0.3.0"><code>enum_delegate</code> v0.3.0</h3>
<ul>
<li><a href="https://crates.io/crates/enum_delegate">crates.io</a></li>
<li><a href="https://gitlab.com/dawn_app/enum_delegate">repository</a></li>
<li>doc: not yet released new version.</li>
<li>commit: 2022/12 <sup class="footnote-reference"><a href="#214">14</a></sup></li>
</ul>
<p>ã“ã® <a href="https://gitlab.com/dawn_app/enum_delegate/-/issues/6">issue</a> ã§ãƒ‡ã‚¶ã‚¤ãƒ³ãŒæ ¹æœ¬çš„ã«å¤‰æ›´ã•ã‚ŒãŸ.</p>
<ul>
<li>generics ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹.</li>
<li>super trait ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_delegate_v030/fail_not_supported_super_trait.rs">rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_delegate_v030/fail_not_supported_super_trait.stderr">stderr</a>]
<sup class="footnote-reference"><a href="#215">15</a></sup>.</li>
<li>associated type/const ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_delegate_v030/fail_not_supported_associated_const.rs">rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_delegate_v030/fail_not_supported_associated_const.stderr">stderr</a>]
<sup class="footnote-reference"><a href="#216">16</a></sup></li>
</ul>
<h4 id="shi-zu-mitoping-jia">ä»•çµ„ã¿ã¨è©•ä¾¡</h4>
<p><code>auto-delegate</code> ã«ä¼¼ã¦ã„ã‚‹ãŒ, struct ã§ã¯ãªã
<code>enum_dispatch::Either&lt;A, enum_dispatch::Either&lt;B, ...enum_dispatch::Either&lt;X, enum_dispatch::Void&gt;&gt;&gt;</code>
ã«å¤‰æ›ã™ã‚‹
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_delegate_v030/pass_basic.rs">example</a>].</p>
<p>auto-delegate ã¨ã®ã“ã®é•ã„ã«ã‚ˆã‚Š, std types ã¯
<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_delegate_v030/pass_supported_std_types.rs">ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹</a>.
<code>impl Hello for enum_dispatch::Either&lt;String, enum_dispatch::Void&gt;</code> ã«ãªã‚‹ãŸã‚.
(<code>Hello</code> å´ã¯ <code>enum_dispatch</code> å´ã«è¦‹ãˆãªã„ã®ã§ auto-delegate ã®æ§˜ãªå•é¡Œã¯èµ·ã“ã‚‰ãªã„.)
å¤–éƒ¨ crate ã® trait ãŒ orphan rule ã«ã²ã£ã‹ã‹ã‚‹ç‚¹ã¯åŒã˜. (<code>enum_dispatch::Either&lt;A, ...&gt;</code> ã¯ local ã§ã¯ãªã„ã®ã§.)
super trait ã¯çœŸé¢ç›®ã«ã‚„ã‚Œã°ã§ãã‚‹ã‹ã‚‚.</p>
<p><a href="https://gitlab.com/dawn_app/enum_delegate/-/issues/6#note_1189900264">æœ€é©åŒ–ã¯ã•ã‚Œã‚‹ã‚‰ã—ã„</a> <sup class="footnote-reference"><a href="#217">17</a></sup>.</p>
<h4 id="enum-delegate-v0-3-0-matome"><code>enum_delegate</code> v0.3.0 ã¾ã¨ã‚</h4>
<p>auto-delegate ã¨åŒã˜. èª­ã‚ãªã„ã—åˆ¶ç´„ãŒãã¤ã™ãã‚‹.</p>
<h3 id="ambassador"><code>ambassador</code></h3>
<ul>
<li><a href="https://crates.io/crates/ambassador">crates.io</a></li>
<li><a href="https://github.com/hobofan/ambassador">repository</a></li>
<li><a href="https://docs.rs/ambassador/0.4.1/ambassador">doc</a> <sup class="footnote-reference"><a href="#218">18</a></sup></li>
<li>Initial commit: 2019/11 <sup class="footnote-reference"><a href="#219">19</a></sup></li>
</ul>
<p>ambassador ã¯ enum_dispatch ã«ç¶™ã„ã§å¤ãã‹ã‚‰ã‚ã‚‹ crate ã§, æ©Ÿèƒ½çš„ã«ã¯æœ€ã‚‚ã‚«ãƒãƒ¼ç¯„å›²ãŒåºƒã„ã§ã™.
ä¸€æ–¹ã§è€ƒãˆã‚‰ã‚Œã‚‹å…¨ã¦ã‚’ã‚«ãƒãƒ¼ã—ã‚ˆã†ã¨ã—ã¦ãŠã‚Šæ§‹æ–‡çš„ã«ã¯è¤‡é›‘ãªã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™.</p>
<p>ã“ã“ã§ã¯å…¨ã¦ã‚’ç´¹ä»‹ã™ã‚‹ã“ã¨ã¯ã›ãš, ç°¡æ½”ã«ã ã‘çºã‚ã¦ãŠãã¾ã™. è©³ç´°ã¯ README ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„.</p>
<ul>
<li>generics ã‚µãƒãƒ¼ãƒˆ [<a href="https://github.com/hobofan/ambassador/tree/0.3.5?tab=readme-ov-file#delegateshoutx---trait-generics">REDAME</a>]</li>
<li>trait bound ã‚µãƒãƒ¼ãƒˆ [<a href="https://github.com/hobofan/ambassador/tree/0.3.5?tab=readme-ov-file#delegate-where--a-shout---where-key">README</a>]</li>
<li>å¤–éƒ¨ crate ã® trait ã‚µãƒãƒ¼ãƒˆ
<ul>
<li>å¤–éƒ¨ crate å´ã§ ambassador ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ
[<a href="https://docs.rs/ambassador/0.4.1/ambassador/#cross-module-uses">doc</a>]</li>
<li>å¤–éƒ¨ crate å´ã§ ambassador ã‚’ä½¿ã£ã¦ã„ãªã„å ´åˆ
[<a href="https://github.com/hobofan/ambassador/tree/0.3.5?tab=readme-ov-file#for-remote-traits-delegatable_trait_remote">README</a>]</li>
</ul>
</li>
<li>å¤–éƒ¨ crate ã® struct ã‚‚æ‰±ãˆã‚‹ [<a href="https://github.com/hobofan/ambassador/tree/0.3.5?tab=readme-ov-file#for-remote-types-delegate_remote">README</a>]</li>
<li>trait ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒ receiver ä»¥å¤–ã®å¼•æ•°ã‚’å–ã£ã¦ã‚‚ã‚ˆã„</li>
<li>è¤‡æ•° field ã‚’æŒã¤ struct ã®ã‚µãƒãƒ¼ãƒˆ [<a href="https://github.com/hobofan/ambassador/tree/0.3.5?tab=readme-ov-file#delegate-target--foo---target-key">README</a>]</li>
</ul>
<h4 id="shi-zu-mi">ä»•çµ„ã¿</h4>
<p>åŸºæœ¬çš„ã«ã¯ enum_delegate ã¨åŒã˜ã, proc macro ä¸­ã§ decl macro ã‚’å®šç¾©/åˆ©ç”¨ã—ã¦ã„ã¾ã™
[<a href="https://github.com/hobofan/ambassador/blob/0.3.5/ambassador/src/register.rs#L69-L106">in <code>#[ambassador::derigatable_trait]</code></a>]
[<a href="https://github.com/hobofan/ambassador/blob/0.3.5/ambassador/src/derive.rs#L199-L208">in <code>#[derive(ambassador::Delegate)</code></a>].
derive ã™ã‚‹éš›ã« enum_delegate ã¯ proc macro -&gt; decl macro -&gt; proc macro ã¨å‡¦ç†ã‚’ã—ã¦ã„ã¾ã—ãŸãŒ,
ambassador ã¯ proc macro -&gt; decl macro ã ã‘ã§ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™.
ã“ã‚Œã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚, ambassador ã® decl macro ã¯å…ˆã«ãƒ‘ãƒ¼ãƒ„å˜ä½ã«åŠ å·¥ã—ã¦ãŠã, å‘¼ã³å‡ºã—å´ã§ãã‚Œã‚‰ã‚’åˆ¥å€‹ã«å–ã‚Šå‡ºã™å½¢ã«ãªã£ã¦ã„ã¾ã™.</p>
<h4 id="shi-zu-minoping-jia">ä»•çµ„ã¿ã®è©•ä¾¡</h4>
<p>ã‚ã‚“ã¾ã‚Šå·®ãŒãªã„ã®ã§çœç•¥.</p>
<p>å€‹äººçš„ã«ã¯ proc macro -&gt; decl macro ã§å‡¦ç†ã—ã¦ã„ã‚‹åˆ†ç…©é›‘ã«ãªã£ã¦ã„ã‚‹ã¨æ€ã†. 4ç« ã§ã¡ã‚‰ã£ã¨è§¦ã‚Œã¾ã™.</p>
<h4 id="ambassador-matome"><code>ambassador</code> ã¾ã¨ã‚</h4>
<ul>
<li>ä»•çµ„ã¿: proc macro ä¸­ã§ decl macro ã‚’ä½¿ã†.</li>
<li>æ©Ÿèƒ½çš„ã«ã‚«ãƒãƒ¼ç¯„å›²ãŒåºƒã„.</li>
</ul>
<p>ãŸã¶ã‚“ãŠã™ã™ã‚ã§ã™ <sup class="footnote-reference"><a href="#220">20</a></sup>.</p>
<h3 id="portrait"><code>portrait</code></h3>
<ul>
<li><a href="https://crates.io/crates/portrait">crates.io</a></li>
<li><a href="https://github.com/SOF3/portrait">repository</a></li>
<li><a href="https://docs.rs/portrait/0.3.0/portrait">doc</a></li>
<li>Initial commit: 2023/01</li>
</ul>
<p>portrait ã¯ enum ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ãŒä¸€å¿œå–ã‚Šä¸Šã’ã¦ãŠãã¾ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">portrait</span><span>::</span><span style="color:#bf616a;">make</span><span>]
</span><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>RectWrapper(Rect);
</span><span>
</span><span>#[</span><span style="color:#bf616a;">portrait</span><span>::</span><span style="color:#bf616a;">fill</span><span>(portrait::</span><span style="color:#bf616a;">delegate</span><span>(Rect; self.0))]
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>RectWrapper {}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span></code></pre>
<p>proc macro ã®ä¸­ã« proc macro ã‚’è¨˜è¿°ã™ã‚‹ã¨ã„ã†ç‹¬ç‰¹ãªã‚¹ã‚¿ã‚¤ãƒ«ã§ã™. <code>portrait::delegate</code> ã®éƒ¨åˆ†ã«ã¯ã“ã‚Œä»¥å¤–ã‚‚æ›¸ãã“ã¨ãŒã§ãã¾ã™
[<a href="https://docs.rs/portrait/0.3.0/portrait/#provided-fillers">doc</a>].</p>
<p>ã¾ãŸ, <strong>attribute ã‚’ struct/enum ã®å®šç¾©ã§ã¯ãªã <code>impl Trait for Struct</code> ã«ä»˜ã‘ã‚‹</strong> ã¨ã„ã†ã®ã‚‚ä»–ã«ã¯ãªã„ç‰¹å¾´ã§ã™.
3ç« ã§è­°è«–ã—ã¾ã™.</p>
<p>ã“ã®å½¢å¼ã¯ <a href="https://github.com/rust-lang/rfcs/pull/2393#issuecomment-394498215">rfcs#2329 ã®ã‚³ãƒ¡ãƒ³ãƒˆ</a> (2018/06)
ã§ææ¡ˆã•ã‚Œã¦ã„ã¾ã™.</p>
<h4 id="shi-zu-mitoping-jia-1">ä»•çµ„ã¿ã¨è©•ä¾¡</h4>
<p>æƒ…å ±ä¼é”ã®ä»•çµ„ã¿ã¯æ®†ã© enum_delegate v0.2.0 ã¨åŒã˜ã§ã™.
proc macro -&gt; decl macro -&gt; proc macro ã§å‡¦ç†ã‚’ã—ã¦ã„ã¾ã™.</p>
<h4 id="portrait-matome"><code>portrait</code> ã¾ã¨ã‚</h4>
<ul>
<li>ä»•çµ„ã¿: proc macro ä¸­ã§ decl macro ã‚’ä½¿ã†.</li>
<li>delegation ä»¥å¤–ã‚‚ã§ãã‚‹.</li>
<li>enum ã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„.</li>
<li>ãƒ†ã‚¹ãƒˆãŒå°‘ãªã„.</li>
</ul>
<p>è©•ä¾¡å¯¾è±¡å¤– <sup class="footnote-reference"><a href="#221">21</a></sup>.</p>
<h3 id="delegate"><code>delegate</code></h3>
<ul>
<li><a href="https://crates.io/crates/delegate">crates.io</a></li>
<li><a href="https://github.com/kobzol/rust-delegate">repository</a></li>
<li><a href="https://docs.rs/delegate/0.13.1/delegate">doc</a></li>
<li>Initial commit: 2018/05</li>
</ul>
<p>ã€ŒRust ã§ delegation ã¨ã„ã£ãŸã‚‰ã“ã‚Œã€ãã‚‰ã„ã®èªçŸ¥åº¦ã‚’èª‡ã‚‹ crate ã§ã™.
ã“ã®è¨˜äº‹ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ã—ã¦ã„ã‚‹è‡ªå‹• delegation ã§ã¯ãªã„ã®ã§ã™ãŒ, thin_delegate ãŒå¤§ããå½±éŸ¿ã•ã‚Œã¦ã„ã‚‹ã®ã§å–ã‚Šä¸Šã’ã¾ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">enum </span><span>Shape {
</span><span>    Rect(Rect),
</span><span>    Circle { circle: Circle, center: (</span><span style="color:#b48ead;">f64</span><span>, </span><span style="color:#b48ead;">f64</span><span>) }
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Shape { </span><span style="color:#65737e;">// or `impl ShapeI for Shape` for `area()`.
</span><span>    delegate::delegate! {
</span><span>        to </span><span style="color:#b48ead;">match </span><span style="color:#bf616a;">self </span><span>{
</span><span>            </span><span style="color:#b48ead;">Self</span><span>::Rect(x) =&gt; x,
</span><span>            </span><span style="color:#b48ead;">Self</span><span>::Circle { circle, .. } =&gt; circle,
</span><span>        }
</span><span>        {
</span><span>            </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">center</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; (</span><span style="color:#b48ead;">f64</span><span>, </span><span style="color:#b48ead;">f64</span><span>) {
</span><span>        </span><span style="color:#b48ead;">match </span><span style="color:#bf616a;">self </span><span>{
</span><span>            </span><span style="color:#b48ead;">Self</span><span>::Rect(_) =&gt; unimplemented!(),
</span><span>            </span><span style="color:#b48ead;">Self</span><span>::Circle { center, .. } =&gt; center.</span><span style="color:#96b5b4;">clone</span><span>(),
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Circle {
</span><span>    </span><span style="color:#bf616a;">radius</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Circle {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#d08770;">3.14 </span><span>* </span><span style="color:#bf616a;">self</span><span>.radius * </span><span style="color:#bf616a;">self</span><span>.radius
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let</span><span> rect = Rect { width: </span><span style="color:#d08770;">2.0</span><span>, height: </span><span style="color:#d08770;">3.0 </span><span>};
</span><span>    assert_eq!(rect.</span><span style="color:#96b5b4;">area</span><span>(), </span><span style="color:#d08770;">6.0</span><span>);
</span><span>    </span><span style="color:#b48ead;">let</span><span> shape = Shape::Rect(rect);
</span><span>    assert_eq!(shape.</span><span style="color:#96b5b4;">area</span><span>(), </span><span style="color:#d08770;">6.0</span><span>);
</span><span>    </span><span style="color:#b48ead;">let</span><span> circle = Circle { radius: </span><span style="color:#d08770;">2.0 </span><span>};
</span><span>    assert_eq!(circle.</span><span style="color:#96b5b4;">area</span><span>(), </span><span style="color:#d08770;">12.56</span><span>);
</span><span>    </span><span style="color:#b48ead;">let</span><span> shape = Shape::Circle { circle, center: (</span><span style="color:#d08770;">0.0</span><span>, </span><span style="color:#d08770;">0.0</span><span>) };
</span><span>    assert_eq!(shape.</span><span style="color:#96b5b4;">area</span><span>(), </span><span style="color:#d08770;">12.56</span><span>);
</span><span>    assert_eq!(shape.</span><span style="color:#96b5b4;">center</span><span>(), (</span><span style="color:#d08770;">0.0</span><span>, </span><span style="color:#d08770;">0.0</span><span>));
</span><span>}
</span></code></pre>
<p>è¦‹ã¦ã®é€šã‚Šã§ã™ãŒ, delegate ã¯æŸ”è»Ÿæ€§ã«ç‰¹åŒ–ã—ã¦ãŠã‚Š, trait method ã® delegation ã«ç¸›ã‚‰ã‚Œã¾ã›ã‚“.
ãã®ä»£ã‚ã‚Š, ãƒ¡ã‚½ãƒƒãƒ‰ã®åˆ—æŒ™ã¯æ‰‹å‹•ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™.</p>
<p>ã¾ãŸ, <a href="https://github.com/kobzol/rust-delegate?tab=readme-ov-file#features">è±Šå¯Œãªæ©Ÿèƒ½</a> ãŒã‚ã‚‹ã‚ˆã†ã§ã™ <sup class="footnote-reference"><a href="#222">22</a></sup>.</p>
<h4 id="shi-zu-mitoping-jia-2">ä»•çµ„ã¿ã¨è©•ä¾¡</h4>
<p>N/A</p>
<h4 id="delegate-matome"><code>delegate</code> ã¾ã¨ã‚</h4>
<p>ãŸã¶ã‚“ãŠã™ã™ã‚ã§ã™.</p>
<h3 id="delegate-attr"><code>delegate-attr</code></h3>
<ul>
<li><a href="https://crates.io/crates/delegate-attr">crates.io</a></li>
<li><a href="https://github.com/upsuper/delegate-attr">repository</a></li>
<li><a href="https://docs.rs/delegate-attr/0.3.0/delegate_attr">doc</a></li>
<li>Initial commit: 2020/05</li>
</ul>
<p>ã“ã®è¨˜äº‹ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ã—ã¦ã„ã‚‹è‡ªå‹• delegation ã§ã¯ãªã„ã®ã§ã™ãŒç›®ã«å…¥ã£ãŸã®ã§ä¸€å¿œå–ã‚Šä¸Šã’ã¦ãŠãã¾ã™.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">trait </span><span>ShapeI {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64</span><span>;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>RectWrapper(Rect);
</span><span>
</span><span>#[</span><span style="color:#bf616a;">delegate_attr</span><span>::</span><span style="color:#bf616a;">delegate</span><span>(self.0)]
</span><span style="color:#b48ead;">impl </span><span>RectWrapper {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{}
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Rect {
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">f64</span><span>,
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ShapeI </span><span style="color:#b48ead;">for </span><span>Rect {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">area</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">f64 </span><span>{
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width * </span><span style="color:#bf616a;">self</span><span>.height
</span><span>    }
</span><span>}
</span></code></pre>
<h4 id="shi-zu-mitoping-jia-3">ä»•çµ„ã¿ã¨è©•ä¾¡</h4>
<p>N/A</p>
<h4 id="delegate-attr-matome"><code>delegate-attr</code> ã¾ã¨ã‚</h4>
<p>è©•ä¾¡å¯¾è±¡å¤– <sup class="footnote-reference"><a href="#223">23</a></sup>.</p>
<h3 id="summary">2ç« ã¾ã¨ã‚</h3>
<p>ã“ã®ç« ã§ã¯ proc macro é–“ã§ã®æƒ…å ±ä¼é”ã¨ delegation crate æ¯”è¼ƒã‚’è¡Œã„ã¾ã—ãŸ.</p>
<p>trait method ã®è‡ªå‹• delegation ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹æƒ…å ±ä¼é”æ–¹æ³•ã¯ç¾çŠ¶ã¿ã£ã¤ã§ã™:</p>
<ul>
<li>proc macro ä¸­ã® global variable ã‚’ä½¿ã†
<ul>
<li>åˆæ³•ã§ã¯ãªã„. ä½¿ã†ã¹ãã§ã¯ãªã„.</li>
</ul>
</li>
<li>proc macro ä¸­ã§ decl macro ã‚’ä½¿ã†
<ul>
<li>æŸ”è»Ÿã«å¯¾å¿œå¯èƒ½. ä»–ã®ã‚±ãƒ¼ã‚¹ã«ã‚‚å¿œç”¨ãŒåŠ¹ããã†.</li>
</ul>
</li>
<li>é–“ã« struct/enum/trait ã‚’æŒŸã‚€
<ul>
<li>åˆ¶ç´„ãŒå¼·ã„. ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¨ã—ã¦çŸ¥ã£ã¦ãŠã„ã¦æã¯ãªã•ãã†.</li>
</ul>
</li>
</ul>
<p>ã“ã®è¦³ç‚¹ã‹ã‚‰ã¯, <strong>trait method ã«å¯¾ã—ã¦ã¯ ambassador, ãã‚Œä»¥å¤–ã«ã¤ã„ã¦ã¯ delegate</strong> ã¨ã„ã†ä½¿ã„åˆ†ã‘ã«ãªã‚‹ã§ã—ã‚‡ã† <sup class="footnote-reference"><a href="#224">24</a></sup> <sup class="footnote-reference"><a href="#225">25</a></sup>.</p>
<p><a href="../2025-01-04-thin_delegate-3">3ç« </a> ã§ã¯ thin_delegate ã®è¨­è¨ˆã¨å®Ÿè£…ã®è©±ã‚’ã—ã¾ã™.</p>
<div class="footnote-definition" id="201"><sup class="footnote-definition-label">1</sup>
<p>ã€Œãã†ã§ãªã‘ã‚Œã°ã€ã¨ã„ã†ã®ã¯æ­£ç¢ºã§ã¯ãªã„ãŒç†è§£ã—ã‚„ã™ã•ã‚’å„ªå…ˆã—ã¦ã“ã®æ§˜ãªèª¬æ˜ã«ã—ãŸ.
(ã¾ãæŒ™å‹•ã¨ã—ã¦é–“é•ã£ã¦ã¯ã„ãªã„ (ã¯ãš).) æ­£ç¢ºãªç†è§£ã®ãŸã‚ã«ã¯ã‚³ãƒ¼ãƒ‰ã‚’è¿½ã£ã¦ãã ã•ã„.</p>
</div>
<div class="footnote-definition" id="202"><sup class="footnote-definition-label">2</sup>
<p>ä¾‹ã§ã¯ 1 ãƒ•ã‚¡ã‚¤ãƒ«ã§èª¬æ˜ã—ã¦ã„ã¾ã™ãŒ, trait ã¨ enum ã®å®šç¾©ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ç½®ãã®ã¯æ™®é€šã«ã‚„ã‚Šã¾ã™.
ã“ã®ã¨ã proc macro ã®è©•ä¾¡é †åºã¯ proc macro ä½œè€…ã¨ã—ã¦ã¯æœŸå¾…ã§ããªã„ã¨æ€ã£ã¦ãŠã„ãŸæ–¹ãŒè‰¯ã„ã§ã™.
(åƒ•ã®ã‚¯ã‚½é›‘ç†è§£ã§ã¯ rustc ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯ (ç‰¹ã« proc macro è§£æ±ºãƒ•ã‚§ãƒ¼ã‚ºã¯) æ±ºå®šçš„ã§ã¯ã‚ã‚‹ãŒ,
ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã©ã®é †åºã§èª­ã¾ã‚Œã‚‹ã‹ã¯æ™®é€šæ„è­˜ã—ãªã„ãŸã‚.)
ã‚ãã¾ã§æ¨æ¸¬ã§ã™ãŒã€Œdefer ã®ä»•çµ„ã¿ãŒãªã„ã¨ã“ã®å•é¡Œã«å¯¾å¿œã§ããªã„ã€ã¨ã„ã†ã“ã¨ã§ã“ã†ã„ã†ä½œã‚Šã«ãªã£ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†.</p>
</div>
<div class="footnote-definition" id="203"><sup class="footnote-definition-label">3</sup>
<p>Rustonomicon ã«ã“ã®ã‚ãŸã‚Šã®ã“ã¨æ›¸ã„ã¦ãªã„ã£ã½ã„ã‚“ã§ã™ã‚ˆã­ã‡...
ãªã®ã§ã“ã“ã§è¨€ã†ã€Œåˆæ³•ã€ã¨ã„ã†ã®ã¯ Rust å…¬å¼ã®ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ã¯ãªã„ã—, å®šç¾©ã‚‚ãªã„.
ã“ã®è¨˜äº‹ã®ä¸­ã§ã®ã¿ä½¿ã„, ã€Œãªã‚“ã‹å•é¡Œãªãå‹•ããã†ã€ãã‚‰ã„ã®æ„å‘³ã§ã‚ã‚‹.
((ã“ã“ã«é™ã‚‰ãªã„ã‘ã©) èª°ã‹çŸ¥ã£ã¦ãŸã‚‰æ•™ãˆã¦ãã ã•ã„.)</p>
</div>
<div class="footnote-definition" id="204"><sup class="footnote-definition-label">4</sup>
<p>ã§ã‚‚ãªã‚“ã‹æœŸå¾…ã—ãŸæŒ™å‹•ã«ã¯ãªã‚‰ãªã„ã‚“ã§ã™ã‚ˆã­...
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/pass_def_in_other_mod_without_arg_incorrect.rs">3</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_def_in_other_mod_with_arg.rs">4 rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/fail_def_in_other_mod_with_arg.stderr">4 stdeerr</a>].</p>
</div>
<div class="footnote-definition" id="205"><sup class="footnote-definition-label">5</sup>
<p>rustc/cargo ã‚’èª­ã‚“ã§ç¢ºå®šã•ã›ã‚ã¨ã„ã†è©±ã§ã™ãŒ...</p>
</div>
<div class="footnote-definition" id="206"><sup class="footnote-definition-label">6</sup>
<p>è¨˜äº‹ã‚’æ›¸ãã«ã‚ãŸã£ã¦èª¿ã¹ç›´ã—ã¦ã„ã¦ crates.io ã‚’è¦‹ã¦é©šãã¾ã—ãŸ.
æµçŸ³ã« ambassader ã®æ–¹ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°å¤šã„ã¨æ€ã£ã¦ã„ãŸã®ã§...</p>
</div>
<div class="footnote-definition" id="207"><sup class="footnote-definition-label">7</sup>
<p>enum_dispatch ã«é™ã‚‰ãšã“ã®ç« ã§ãŠã™ã™ã‚ã—ãªã„ã¨æ›¸ã„ã¦ã„ã‚‹å…¨ã¦ã® crate ã«è¨€ãˆã‚‹ã“ã¨ã§ã™ãŒ,
ã‚ãªãŸãŒç®¡ç†ã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ã†åˆ†ã«ã¯å•é¡Œãªã„å£Šã‚Œæ–¹ã ã¨æ€ã„ã¾ã™.
ã¨ã¯ã„ãˆç¾ä»£ã§ã¯ ambassader ã‚„ thin_delegate ã¨ã„ã£ãŸåˆæ³•ãª crate ãŒã‚ã‚Š,
API ã‚‚ä¼¼ãŸæ„Ÿã˜ãªã®ã§ä¹—ã‚Šæ›ãˆã‚‹ã®ã‚’ãŠã™ã™ã‚ã—ã¾ã™.</p>
</div>
<div class="footnote-definition" id="208"><sup class="footnote-definition-label">8</sup>
<p>åƒ•ã¯ rustc ã®æŒ™å‹•ã«è©³ã—ããªã„ã®ã§ã¼ã‹ã—ã¦ãŠã.
<a href="https://rustc-dev-guide.rust-lang.org/macro-expansion.html#expansion-and-ast-integration">ã“ã®ã¸ã‚“</a>
ã‹ã‚‰å§‹ã‚ã¦ã„ã‘ã°ã‚ã‹ã‚‹æ°—ãŒã™ã‚‹.</p>
</div>
<div class="footnote-definition" id="209"><sup class="footnote-definition-label">9</sup>
<p>enum_dispatch ã®æœ€æ–°ç‰ˆ (0.3.13) ã ã¨ã“ã‚Œã¯æ‰±ãˆã¾ã™
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/pass_super_trait.rs">rs</a>]
[<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui/enum_dispatch/pass_super_trait.rs">stderr</a>].</p>
</div>
<div class="footnote-definition" id="210"><sup class="footnote-definition-label">10</sup>
<p><a href="https://crates.io/crates/trybuild">trybuild</a> ã‚’ä½¿ã£ã¦ unsupported case ã‚’æ›¸ã„ã¦ã„ã¦ãã‚Œã¦ãƒã‚¸ã§ã‚ã‚ŠãŒã¨ã†.
<a href="https://github.com/kenoss/kenoss.github.io/tree/main/content/blog/2025-01-01-thin_delegate_aux/tests/ui">è‡ªåˆ†ã§æ›¸ã„ã¦æ¤œè¨¼</a> ã›ãšã«æ¸ˆã‚“ã .
å…¨äººé¡è¦‹ç¿’ã†ã¹ãã ã‚ˆ.</p>
</div>
<div class="footnote-definition" id="211"><sup class="footnote-definition-label">11</sup>
<p>ç™ºè¦‹ã•ã‚Œã¦ã„ãªã„. ã¾ãã§ã‚‚å¤šåˆ†å•é¡Œãªã„ã§ã—ã‚‡ã†.</p>
</div>
<div class="footnote-definition" id="212"><sup class="footnote-definition-label">12</sup>
<p>(ã¡ã‚ƒã‚“ã¨ãƒã‚§ãƒƒã‚¯ã—ã¦ãªã„ã‘ã©) <code>impl Trait for auto_delegate::Delegates&lt;...&gt;</code> ã® if åˆ†å²ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®æœ€é©åŒ–ã§æ¶ˆãˆã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¦ã„ã‚‹ã¨æ€ã†.
(ã¡ã‚ƒã‚“ã¨ã‚„ã‚‰ãªã„ã¨ã„ã‘ãªã„ã®ã§æ¶ˆãˆãªãã¦ã‚‚ãŠã‹ã—ãã¯ãªã„ã‘ã©.)</p>
</div>
<div class="footnote-definition" id="213"><sup class="footnote-definition-label">13</sup>
<p>ã§ã‚‚ enum_delegate v0.3.0 ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ super trait ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãŸã‚Š,
(ã¡ã‚‡ã£ã¨å¼„ã£ãŸæ„Ÿã˜) generics/trait bound ã¾ã‚ã‚Šã§åä¾‹ãŒä½œã‚Œãªã„ã®ã§é ‘å¼µã£ã¦ã¯ã„ã‚‹ã¨æ€ã†.</p>
</div>
<div class="footnote-definition" id="214"><sup class="footnote-definition-label">14</sup>
<p>auto-delegate ã® initial commit ã‚ˆã‚Šå‰ã§ã‚ã‚‹. v0.3.0 ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ãªã„ã‘ã©...
(ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ãªãã¦å›°ã£ã¦ <a href="https://crates.io/crates/temporary_enum_delegate_0_3_0">é‡è‰¯ãƒªãƒªãƒ¼ã‚¹</a> ã—ã¦ã‚‹äººãŒãŠã‚‹.)</p>
</div>
<div class="footnote-definition" id="215"><sup class="footnote-definition-label">15</sup>
<p>çœŸé¢ç›®ã«ã‚„ã‚Œã°ã§ãã‚‹ã®ã‹ã‚‚ã—ã‚Œãªã„ãŒã“ã®ä»•çµ„ã¿ã®ä¸Šã§ã‚ã‚“ã¾ã‚Šé ‘å¼µã£ã¦ã‚‚ãª...</p>
</div>
<div class="footnote-definition" id="216"><sup class="footnote-definition-label">16</sup>
<p>ã“ã® <a href="https://gitlab.com/dawn_app/enum_delegate/-/merge_requests/1/diffs">PR</a>
ã§ not supported case ã®ãƒ†ã‚¹ãƒˆãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹. ã“ã®ä»•çµ„ã¿ã¯æœ‰æœ›ã§ã¯ãªã„ã¨æ€ã£ã¦ã„ã‚‹ã®ã§è£å–ã‚ŠãŒé¢å€’ã«ãªã£ã¦ããŸ.
enum_delegate v0.3.0 ã®å®Ÿè£…ã¯æ–œã‚èª­ã¿ã§ã»ã¼ã»ã¼ <code>cargo expand</code> ã—ã‹è¦‹ã¦ã„ãªã„.</p>
</div>
<div class="footnote-definition" id="217"><sup class="footnote-definition-label">17</sup>
<p>ã—ã‹ã—ãã‚Œ, ç¾æ™‚ç‚¹ã§å·®ãŒãªã„ã“ã¨ã¯ã‚ã‹ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã‘ã©ç¶™ç¶šçš„ä¿è¨¼ã«ãªã£ã¦ãªã„ã®ã§ã¯...?</p>
</div>
<div class="footnote-definition" id="218"><sup class="footnote-definition-label">18</sup>
<p>docs.rs ã®æ–¹ã¯ 0.4.1 ãŒæœ€æ–°ã ãŒãƒªãƒã‚¸ãƒˆãƒªå´ã® tag ã¯ 0.3.5 ãŒæœ€æ–°. ãšã‚Œã‚‹ã‘ã©è¨±ã—ã¦.
(æœ€æ–°ã‚’å‚ç…§ã—ãªã„ã®ã¯ãƒ•ã‚§ã‚¢ã˜ã‚ƒãªã„æ„ŸãŒã‚ã‚‹.)</p>
</div>
<div class="footnote-definition" id="219"><sup class="footnote-definition-label">19</sup>
<p>èª¬æ˜ã®éƒ½åˆã§é †åºãŒé€†ã«ãªã£ã¦ç”³ã—è¨³ãªã„ãŒ, enum_delegate ã‚ˆã‚Šã‚‚ ambassador ã®æ–¹ãŒç™»å ´ãŒã ã„ã¶æ—©ã„.
(ambassodor, æ©Ÿèƒ½ã‚‚æ§‹æ–‡ã‚‚è¤‡é›‘ãªã‚“ã§ã™ã‚ˆã­ã‡...)</p>
</div>
<div class="footnote-definition" id="220"><sup class="footnote-definition-label">20</sup>
<p>å®Ÿéš›ã®ã¨ã“ã‚ã¯, æ§‹æ–‡ãŒå¥½ãã˜ã‚ƒãªãã¦ã‚ã‚“ã¾ã‚Šã¾ã˜ã‚ã«ç§˜å­”ã‚’çªãä½œæ¥­ã‚’ã—ã¦ãªã„ã®ã§ã‚ˆãã‚ã‹ã‚‰ãªã„...
(å…ˆè¡Œç ”ç©¶ã¯ã‚‚ã£ã¨ã¡ã‚ƒã‚“ã¨èª¿ã¹ã‚ã¨ã„ã†ã®ã¯ã¯ã„...)
ã¾ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ãƒ†ã‚¹ãƒˆã‚„ issue ã‚’è¦‹ã¦ã„ã‚‹é™ã‚Šã§ã¯ä¿¡é ¼ã§ãã‚‹ã¨æ€ã„ã¾ã™. (How it works ã¯æ›¸ã„ã¦ã»ã—ã‹ã£ãŸ.)
æ©Ÿèƒ½ãŒã“ã‚Œã§ååˆ†ã§æ§‹æ–‡ãŒå«Œã„ã§ãªã‘ã‚Œã°ä½¿ã†ã®ã¯æ­¢ã‚ã¾ã›ã‚“.</p>
</div>
<div class="footnote-definition" id="221"><sup class="footnote-definition-label">21</sup>
<p><code>syn::custom_keyword!</code> ã¯ã“ã“ã§çŸ¥ã£ãŸ. ã‚ã‚ŠãŒã¨ã†.</p>
</div>
<div class="footnote-definition" id="222"><sup class="footnote-definition-label">22</sup>
<p>ã“ã†ã„ã†ã‚´ãƒ†ã‚´ãƒ†ã—ãŸã®ã¯åƒ•ã®å¥½ã¿ã§ã¯ãªã„. è¦šãˆã‚‰ã‚Œãªã„. (æœ¬å½“ã«å¿…è¦?)
ã¾ã <a href="https://github.com/rust-lang/rfcs/pull/3530#issuecomment-1824320933">rfcs#3530 ã®ã‚³ãƒ¡ãƒ³ãƒˆ</a>
ã§ author ã® Kobzol ãŒè¨€ã£ã¦ã„ã‚‹æ§˜ã«, è‰²ã€…äº‹æƒ…ã¯ã‚ã‚‹ã‚“ã§ã—ã‚‡ã†.
åƒ•ã¯ã“ã®å•é¡Œã‚’2ãƒ¶æœˆãã‚‰ã„ã—ã‹è€ƒãˆã¦ãªã„ã®ã§ã€Œå¥½ã¿ã˜ã‚ƒãªã„ã€ä»¥ä¸Šã®ã“ã¨ã¯è¨€ãˆãªã„.</p>
</div>
<div class="footnote-definition" id="223"><sup class="footnote-definition-label">23</sup>
<p>delegate ä½¿ãˆã°ã‚ˆããªã„? ambassador ã‚ˆã‚Šãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°ãŒå¤šã„ã®ã‚‚ã‚ˆãã‚ã‹ã‚‰ãªã„ã—...</p>
</div>
<div class="footnote-definition" id="224"><sup class="footnote-definition-label">24</sup>
<p><a href="https://github.com/rust-lang/rfcs/pull/2393#issuecomment-801324543">rfcs#2329 ã®ã‚³ãƒ¡ãƒ³ãƒˆ</a> (2021/03)
ã§ã‚‚ ambassador ã¨ delegate ãŒå¼•ãåˆã„ã«å‡ºã•ã‚Œã¦ã„ã‚‹.</p>
</div>
<div class="footnote-definition" id="225"><sup class="footnote-definition-label">25</sup>
<p>åƒ•å€‹äººã¨ã—ã¦ã¯ thin_delegate ã®æ–¹ãŒå¥½ããªã®ã§, ã€Œtrait method ã«ã¤ã„ã¦ã¯ thin_delegate, ãã‚Œä»¥å¤–ã«ã¤ã„ã¦ã¯ delegateã€
ã«ãªã‚‹ã¨æ€ã„ã¾ã™. delegate crate ã‚’ä½¿ã„ãŸããªã‚‹ã‚±ãƒ¼ã‚¹ã¯ä»Šã®ã¨ã“ã‚æ€ã„æµ®ã‹ã³ã¾ã›ã‚“ãŒ.</p>
</div>

    </div>
</article>

            </main>
            <footer>
                <div class="footer">
                    <small class="footer-left">
                        Â© 2021--2024. All rights reserved.
                    </small>
                    <small class="footer-right">
                        Powered by <a href="https://www.getzola.org">Zola</a>
                    </small>
                </div>
            </footer>
        </div>
    </body>
</html>
